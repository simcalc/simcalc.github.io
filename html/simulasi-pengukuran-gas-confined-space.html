<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Pengukuran Gas Confined Space dan Pertukaran Udara</title>
    <style>
        :root {
            --bg-light: #f0f4f8;
            --bg-card: #ffffff;
            --text-dark: #2b2d42;
            --text-light: #5a6a7b;
            --border-color: #dee2e6;
            --safe: #2a9d8f;
            --warning: #e9c46a;
            --danger: #e76f51;
            --primary: #0056b3;
            --button-bg: #4a4e69;
            --button-hover: #2b2d42;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .main-container {
            width: 100%;
            max-width: 900px;
            text-align: center;
        }
        .header-visual {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 15px; 
        }
        .header-icon-group {
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-light); font-size: 12px; font-weight: 600;
            transition: transform 0.2s ease-in-out; cursor: pointer; width: 20%; 
        }
        .header-icon-group svg { width: 48px; height: 48px; margin-bottom: 8px; }
        .header-icon-group:hover { transform: scale(1.1); }
        .simulation-area {
            display: flex;
            flex-direction: column; /* Mengubah orientasi agar judul di atas */
            gap: 15px;
            background-color: var(--bg-card);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .simulation-title {
            font-size: 1.75rem;
            color: var(--text-dark);
            margin-bottom: 10px;
        }
        .simulation-content {
            display: flex;
            gap: 15px;
            width: 100%;
        }
        .canvas-wrapper {
            flex: 1 1 45%;
            min-height: 400px;
            position: relative;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
            background-color: var(--bg-light);
            border-radius: 10px;
            position: absolute;
            top: 0;
            left: 0;
        }
        .gas-text-overlay {
            position: absolute;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            color: var(--text-dark);
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .gas-text-overlay.visible {
            opacity: 1;
        }
        #text-ch4 { top: 25%; }
        #text-co { top: 50%; }
        #text-h2s { top: 80%; }
        .gas-text-overlay p {
            margin: 0;
            padding: 0;
            line-height: 1.4;
        }
        .gas-main-text { font-size: 13px; }
        .gas-sub-text { font-size: 11px; color: var(--text-light); margin-top: 4px; }
        .controls-wrapper {
            flex: 1 1 55%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
        }
        .gas-display-panel {
            background-color: #2b3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
        }
        .gas-reading { display: flex; align-items: center; margin-bottom: 10px; }
        .gas-reading:last-child { margin-bottom: 0; }
        .gas-label { width: 15%; font-weight: bold; }
        .gas-bar-container { flex-grow: 1; background-color: #4a4e69; border-radius: 5px; height: 16px; margin: 0 10px; overflow: hidden; }
        .gas-bar { height: 100%; border-radius: 5px; transition: width 0.5s ease, background-color 0.5s ease; }
        .gas-value { width: 20%; text-align: right; }
        .action-buttons { display: flex; gap: 10px; }
        .sim-button {
            flex-grow: 1; padding: 12px; border-radius: 8px; border: none;
            background-color: var(--button-bg); color: white;
            font-weight: bold; cursor: pointer; transition: background-color 0.2s ease;
        }
        .sim-button:hover { background-color: var(--button-hover); }
        .calculator { padding: 15px; border: 1px solid var(--border-color); border-radius: 10px; flex-grow: 1;}
        .calculator h3 { margin-top: 0; }
        .input-group { display: flex; align-items: center; margin-bottom: 10px; }
        .input-group label { width: 30%; }
        .input-group input { width: 70%; padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); }
        .results-group { margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 15px; }
        .result-item { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
        .result-item .label { color: var(--text-light); }
        .result-item .value { font-weight: bold; color: var(--text-dark); }
        .result-item .sub-value { font-size: 12px; color: var(--text-light); text-align: right; }
        .discussion-section, .footer { margin-top: 15px; }
        .discussion-section { padding: 20px; background-color: var(--bg-card); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: left; color: var(--text-dark); }
        .footer a { color: var(--primary); text-decoration: none; font-weight: 600; }
        .header-visual .header-icon-group { width: auto; flex-basis: 22%;}
        .discussion-section h3, .discussion-section h2, .discussion-section p, .discussion-section li, .references li { text-align: left; }
        .citation {
            font-weight: bold;
            color: var(--danger);
            font-size: 0.8em;
            vertical-align: super;
            text-decoration: none;
        }
        .example-calc {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        @media (max-width: 767px) {
            .simulation-title { font-size: 1.5rem; }
            .simulation-content { flex-direction: column; }
            .canvas-wrapper { order: 2; height: 450px; }
            .controls-wrapper { order: 1; }
            .gas-main-text { font-size: 11.5px; }
            #text-ch4 { top: 25%; }
            #text-co { top: 50%; }
            #text-h2s { top: 80%; }
        }
    </style>
</head>
<body>
    <div class="main-container">

        <div class="header-visual">
            <div class="header-icon-group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#e76f51" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L3.41 13.41a2 2 0 0 1 0-2.83l7.17-7.17a2 2 0 0 1 2.83 0l7.17 7.17a2 2 0 0 1 0 2.83z"></path><line x1="12" y1="3" x2="12" y2="21"></line></svg><span>Bahaya Gas</span></div>
            <div class="header-icon-group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#e9c46a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg><span>Ruang Terbatas</span></div>
            <div class="header-icon-group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#2a9d8f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l-7-7 7-7 7 7-7 7z"></path><path d="M12 12l-4-4 4-4 4 4-4 4z"></path></svg><span>Pengukuran</span></div>
            <div class="header-icon-group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#005f73" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 8v4l2 2"></path><path d="M16.24 7.76l-1.41 1.41"></path><path d="M7.76 16.24l-1.41 1.41"></path></svg><span>Ventilasi Udara</span></div>
        </div>

        <div class="simulation-area">
            <h1 class="simulation-title">Simulasi Pengukuran Gas Confined Space dan Perhitungan Blower</h1>
            <div class="simulation-content">
                <div class="canvas-wrapper">
                    <canvas id="simulationCanvas"></canvas>
                    <div id="text-ch4" class="gas-text-overlay">
                        <p class="gas-main-text">Pengujian Gas pada Lapisan Atas untuk memastikan tidak adanya gas methane.</p>
                        <p class="gas-sub-text">(CH₄, BM=16)</p>
                    </div>
                    <div id="text-co" class="gas-text-overlay">
                         <p class="gas-main-text">Uji Lapisan Tengah untuk gas seperti Karbon Monoksida yang beratnya sama dengan udara.</p>
                        <p class="gas-sub-text">(CO, BM=28)</p>
                    </div>
                    <div id="text-h2s" class="gas-text-overlay">
                         <p class="gas-main-text">Gas Hidrogen Sulfida sangat beracun dan lebih berat dari udara, uji Lapisan Bawah.</p>
                        <p class="gas-sub-text">(H₂S, BM=34)</p>
                    </div>
                </div>

                <div class="controls-wrapper">
                    <div class="gas-display-panel">
                        <div class="gas-reading"><div class="gas-label">O₂</div><div class="gas-bar-container"><div id="o2-bar" class="gas-bar"></div></div><div id="o2-value" class="gas-value">20.9 %</div></div>
                        <div class="gas-reading"><div class="gas-label">LEL</div><div class="gas-bar-container"><div id="lel-bar" class="gas-bar"></div></div><div id="lel-value" class="gas-value">0 %</div></div>
                        <div class="gas-reading"><div class="gas-label">H₂S</div><div class="gas-bar-container"><div id="h2s-bar" class="gas-bar"></div></div><div id="h2s-value" class="gas-value">0 ppm</div></div>
                        <div class="gas-reading"><div class="gas-label">CO</div><div class="gas-bar-container"><div id="co-bar" class="gas-bar"></div></div><div id="co-value" class="gas-value">0 ppm</div></div>
                    </div>
                    <div class="action-buttons">
                        <button id="start-demo-btn" class="sim-button">Mulai Demo</button>
                        <button id="reset-btn" class="sim-button">Reset</button>
                    </div>
                    <div class="calculator">
                        <h3>Simulasi Perhitungan Blower</h3>
                        <div class="input-group"><label for="input-panjang">Panjang</label><input type="number" id="input-panjang" value="4"></div>
                        <div class="input-group"><label for="input-lebar">Lebar</label><input type="number" id="input-lebar" value="3"></div>
                        <div class="input-group"><label for="input-tinggi">Tinggi</label><input type="number" id="input-tinggi" value="5"></div>
                        <div class="results-group">
                            <div class="result-item"><span class="label">Volume:</span><span id="result-volume" class="value">60.00 m³</span></div>
                            <div class="result-item"><span class="label">Std. ACH (OSHA):</span><span class="value">min 5x, rek. 10x</span></div>
                            <hr style="border: none; border-top: 1px solid var(--border-color); margin: 10px 0;">
                            <div class="result-item"><span class="label">Blower (Rekomendasi):</span><span id="result-flow-rec" class="value">600.00 m³/jam</span></div>
                            <div class="result-item"><span class="label"></span><span id="result-cfm-rec" class="sub-value">(setara 353.1 CFM)</span></div>
                            <div class="result-item"><span class="label">Blower (Minimum):</span><span id="result-flow-min" class="value">300.00 m³/jam</span></div>
                            <div class="result-item"><span class="label"></span><span id="result-cfm-min" class="sub-value">(setara 176.6 CFM)</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="discussion-section">
            <h2>Pembahasan</h2>
            
            <h3>1. Apa itu Confined Space (Ruang Terbatas)?</h3>
            <p>
                Secara definisi, ruang terbatas adalah area yang tidak dirancang untuk pekerjaan berkelanjutan, memiliki akses masuk dan keluar yang terbatas, serta berpotensi memiliki atmosfer berbahaya. Standar internasional seperti OSHA 1910.146 dan peraturan lokal seperti Permenaker No. 11 Tahun 2023 mendefinisikannya sebagai ruangan yang cukup besar untuk dimasuki namun tidak dimaksudkan sebagai tempat kerja rutin.<a href="#ref-1" class="citation">[1]</a><a href="#ref-2" class="citation">[2]</a>
            </p>
            <p>
                Bahaya di ruang terbatas seringkali tidak terlihat dan mematikan, menjadikannya salah satu area kerja paling berisiko. Bahaya-bahaya ini dapat dikategorikan sebagai berikut:
            </p>
            <ul>
                <li><strong>Bahaya Atmosfer:</strong> Ini adalah penyebab utama insiden fatal.
                    <ul>
                        <li><b>Kekurangan atau Kelebihan Oksigen:</b> Kadar oksigen di bawah 19.5% menyebabkan asfiksia, sementara di atas 23.5% meningkatkan risiko kebakaran secara drastis.<a href="#ref-1" class="citation">[1]</a><a href="#ref-4" class="citation">[4]</a></li>
                        <li><b>Atmosfer Mudah Terbakar (Flammable):</b> Gas seperti metana (CH₄) atau uap dari pelarut dapat terakumulasi dan meledak jika bertemu sumber pemicu api.<a href="#ref-5" class="citation">[5]</a></li>
                        <li><b>Atmosfer Beracun (Toxic):</b> Gas seperti Hidrogen Sulfida (H₂S) atau Karbon Monoksida (CO) dapat menyebabkan keracunan atau kematian bahkan pada konsentrasi rendah.</li>
                    </ul>
                </li>
                <li><strong>Bahaya Fisik dan Mekanis:</strong>
                    <ul>
                        <li><b>Engulfment (Tenggelam):</b> Risiko tertimbun oleh material curah seperti pasir, biji-bijian, atau cairan.<a href="#ref-3" class="citation">[3]</a></li>
                        <li><b>Peralatan Bergerak:</b> Risiko terjepit atau tertabrak oleh agitator, auger, atau bagian mesin lain yang tidak diamankan (Lockout/Tagout).<a href="#ref-1" class="citation">[1]</a></li>
                        <li><b>Bahaya Listrik:</b> Risiko sengatan listrik dari kabel yang rusak atau peralatan yang tidak sesuai standar di lingkungan basah/lembab.</li>
                        <li><b>Suhu Ekstrem, Kebisingan, dan Pencahayaan Buruk:</b> Faktor-faktor ini meningkatkan stres fisik dan risiko kesalahan kerja.</li>
                    </ul>
                </li>
            </ul>
            <p>
                <b>Mitigasi utama</b> melibatkan sistem izin kerja yang ketat, pengujian atmosfer sebelum dan selama bekerja, isolasi sumber energi (LOTO), ventilasi yang memadai, serta penyediaan tim penyelamat yang siaga.<a href="#ref-1" class="citation">[1]</a><a href="#ref-2" class="citation">[2]</a><a href="#ref-3" class="citation">[3]</a>
            </p>

            <h3>2. Cara Melakukan Pengukuran Gas</h3>
            <p>
                Asumsi bahwa udara di dalam ruang terbatas bersifat homogen adalah kesalahan fatal. Berbagai gas memiliki berat molekul (BM) yang berbeda relatif terhadap udara (BM ≈ 29), menyebabkan mereka terakumulasi pada lapisan atau strata yang berbeda. Fenomena ini disebut <b>stratifikasi gas</b>.<a href="#ref-5" class="citation">[5]</a> Oleh karena itu, OSHA mengharuskan pengujian dilakukan pada interval vertikal, umumnya setiap 1.2 meter (4 kaki), untuk mendapatkan gambaran atmosfer yang akurat.<a href="#ref-1" class="citation">[1]</a>
            </p>
            <ul>
                <li>
                    <strong>Lapisan Atas (Gas Ringan):</strong> Gas seperti Metana (CH₄, BM=16) jauh lebih ringan dari udara. Mereka akan naik dan terperangkap di bagian paling atas. Pengujian di area ini krusial untuk mencegah risiko ledakan.
                </li>
                <li>
                    <strong>Lapisan Tengah (Gas Seberat Udara):</strong> Gas seperti Karbon Monoksida (CO, BM=28) memiliki berat yang mirip dengan udara. Gas ini cenderung bercampur dan menyebar, sehingga pengujian di lapisan tengah memberikan pembacaan yang paling representatif.
                </li>
                 <li>
                    <strong>Lapisan Bawah (Gas Berat):</strong> Gas seperti Hidrogen Sulfida (H₂S, BM=34) atau uap pelarut lebih berat dari udara. Mereka akan tenggelam dan terkonsentrasi di dasar, menciptakan zona beracun yang mematikan bagi siapa pun yang masuk.
                </li>
            </ul>

            <h3>3. Simulasi Perhitungan Kebutuhan Blower</h3>
            <p>
                Setelah atmosfer berbahaya teridentifikasi, ventilasi paksa adalah langkah mitigasi yang tidak bisa ditawar. Tujuannya adalah untuk mengganti udara terkontaminasi dengan udara bersih hingga mencapai level aman. Standar industri mengukur ini dalam <b>Air Changes per Hour (ACH)</b>, atau berapa kali total volume udara di dalam ruang diganti setiap jamnya.<a href="#ref-1" class="citation">[1]</a><a href="#ref-4" class="citation">[4]</a>
            </p>
            <p>
                Rumus dasar yang digunakan untuk menentukan kapasitas (flow rate) blower yang dibutuhkan adalah:
            </p>
            <div class="example-calc" style="text-align: center;">
                <b>Flow Rate Blower (m³/jam) = Volume Ruang (m³) × Target ACH</b>
            </div>
            
            <div class="example-calc">
                <strong>Contoh Kasus Perhitungan:</strong><br>
                Menggunakan data default dari kalkulator, dimana sebuah tangki memiliki dimensi:
                <ul>
                    <li>Panjang = 4 m</li>
                    <li>Lebar = 3 m</li>
                    <li>Tinggi = 5 m</li>
                </ul>
                <b>Langkah 1: Hitung Volume Ruang</b><br>
                Volume = Panjang × Lebar × Tinggi<br>
                Volume = 4 m × 3 m × 5 m = <b>60 m³</b><br><br>
                <b>Langkah 2: Hitung Kebutuhan Flow Rate Blower</b><br>
                Standar OSHA merekomendasikan minimal 5 ACH, dan merekomendasikan 10 ACH untuk praktik yang lebih aman.<a href="#ref-1" class="citation">[1]</a><br>
                - Kebutuhan Rekomendasi (10 ACH): 60 m³ × 10 = <b>600 m³/jam</b><br>
                - Kebutuhan Minimum (5 ACH): 60 m³ × 5 = <b>300 m³/jam</b><br><br>
                Hasil ini menunjukkan bahwa untuk ventilasi yang efektif dan sesuai standar, diperlukan blower dengan kapasitas minimal 300 m³/jam, dan idealnya 600 m³/jam.
            </div>

            <h2>Daftar Pustaka</h2>
            <ol class="references">
                <li id="ref-1"><b>(Standar Amerika)</b> OSHA. (2015). <i>29 CFR 1910.146 - Permit-required confined spaces</i>. United States Department of Labor. <a href="https://www.osha.gov/laws-regs/regulations/standardnumber/1910/1910.146" target="_blank" rel="noopener noreferrer nofollow">Link</a></li>
                <li id="ref-2"><b>(Standar Indonesia)</b> Kementerian Ketenagakerjaan RI. (2023). <i>Permenaker No. 11 Tahun 2023 tentang Keselamatan dan Kesehatan Kerja di Ruang Terbatas</i>. <a href="https://peraturan.bpk.go.id/Details/282464/permenaker-no-11-tahun-2023" target="_blank" rel="noopener noreferrer nofollow">Link</a></li>
                <li id="ref-3"><b>(Standar Amerika)</b> ANSI/ASSP. (2017). <i>Z117.1-2017 - Safety Requirements for Confined Spaces</i>. American National Standards Institute / American Society of Safety Professionals. <a href="https://www.assp.org/standards/standards-topics/confined-spaces-z117-1" target="_blank" rel="noopener noreferrer nofollow">Link</a></li>
                <li id="ref-4"><b>(Standar Eropa/UK)</b> HSE UK. (2014). <i>L101 - Safe work in confined spaces</i>. Health and Safety Executive. <a href="https://www.hse.gov.uk/pubns/priced/l101.pdf" target="_blank" rel="noopener noreferrer nofollow">Link</a></li>
                <li id="ref-5"><b>(Lembaga Internasional)</b> NIOSH. (1987). <i>Publication No. 87-113: A Guide to Safety in Confined Spaces</i>. U.S. Department of Health and Human Services. <a href="https://www.cdc.gov/niosh/docs/87-113/" target="_blank" rel="noopener noreferrer nofollow">Link</a></li>
                <li id="ref-6"><b>(Jurnal Q1 Internasional)</b> P. K. Marhavilas, D. K. Filippidis, et al. (2021). "A comprehensive risk assessment of confined spaces: A review and a proposed new methodology." <i>Journal of Loss Prevention in the Process Industries, Vol. 71</i>. <a href="https://www.sciencedirect.com/journal/journal-of-loss-prevention-in-the-process-industries" target="_blank" rel="noopener noreferrer nofollow">Link Jurnal</a></li>
                <li id="ref-7"><b>(Jurnal SINTA 1 Indonesia)</b> I. N. A. Arsana, I. M. D. Adnyana. (2022). "Analisis Risiko Keselamatan dan Kesehatan Kerja (K3) pada Pekerjaan di Ruang Terbatas (Confined Space)." <i>Jurnal Spektran, Vol. 10(2)</i>, pp. 155-164. <a href="https://ejurnal.ppsdmmigas.esdm.go.id/sp/index.php/swarapatra/article/view/58" target="_blank" rel="noopener noreferrer nofollow">Link Jurnal</a></li>
            </ol>
        </div>

        <div class="footer">
            <div>Designed by <a href="https://id.linkedin.com/in/mokhamadabrar" target="_blank" rel="noopener">Mokhamad Abrar</a></div>
            <div>Reviewed by <a href="https://id.linkedin.com/in/avior-qhse" target="_blank" rel="noopener">Ratu Avior, MSc.</a> and <a href="https://id.linkedin.com/in/raniannisaroyani" target="_blank" rel="noopener noreferrer">Ir. Rani A. Royani, MSc.</a></div>
            <div>Sustainable Apps Development @ Aug 2025</div>
        </div>
    </div>

    <script>
        // --- Referensi Elemen HTML ---
        const startDemoBtn = document.getElementById('start-demo-btn');
        const resetBtn = document.getElementById('reset-btn');
        const o2Bar = document.getElementById('o2-bar');
        const o2Value = document.getElementById('o2-value');
        const lelBar = document.getElementById('lel-bar');
        const lelValue = document.getElementById('lel-value');
        const h2sBar = document.getElementById('h2s-bar');
        const h2sValue = document.getElementById('h2s-value');
        const coBar = document.getElementById('co-bar');
        const coValue = document.getElementById('co-value');
        const inputPanjang = document.getElementById('input-panjang');
        const inputLebar = document.getElementById('input-lebar');
        const inputTinggi = document.getElementById('input-tinggi');
        const resultVolume = document.getElementById('result-volume');
        const resultFlowRec = document.getElementById('result-flow-rec');
        const resultCfmRec = document.getElementById('result-cfm-rec');
        const resultFlowMin = document.getElementById('result-flow-min');
        const resultCfmMin = document.getElementById('result-cfm-min');
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const textCH4 = document.getElementById('text-ch4');
        const textCO = document.getElementById('text-co');
        const textH2S = document.getElementById('text-h2s');

        // --- Variabel State & Konfigurasi ---
        let state = {};
        const colors = {
            tank: '#d0d8e0', tankBorder: '#8d99ae', text: '#2b2d42',
            safe: '#2a9d8f', warning: '#e9c46a', danger: '#e76f51', hose: '#5a6a7b',
            airClean: 'rgba(173, 216, 230, 0.7)', airDirty: 'rgba(169, 169, 169, 0.6)'
        };

        // --- FUNGSI UTAMA ---
        function getInitialState() {
            return {
                probeHeight: 0, showCH4: false, showCO: false, showH2S: false,
                isVentilating: false, ventilatorAngle: 0,
                particles: [], iconAnimationPhase: 0, isDemoRunning: false, demoTimeoutId: null,
                readings: {
                    o2: { value: 20.9, unit: '%', color: colors.safe, bar: 100 },
                    lel: { value: 0, unit: '%', color: colors.safe, bar: 0 },
                    h2s: { value: 0, unit: 'ppm', color: colors.safe, bar: 0 },
                    co: { value: 0, unit: 'ppm', color: colors.safe, bar: 0 }
                },
                calculator: {
                    panjang: 4, lebar: 3, tinggi: 5, volume: 0, 
                    flowM3: 0, flowM3_min: 0, flowCFM: 0, flowCFM_min: 0
                }
            };
        }

        function updateUI() {
            o2Value.textContent = `${state.readings.o2.value.toFixed(1)} ${state.readings.o2.unit}`;
            o2Bar.style.width = `${state.readings.o2.bar}%`;
            o2Bar.style.backgroundColor = state.readings.o2.color;
            lelValue.textContent = `${state.readings.lel.value} ${state.readings.lel.unit}`;
            lelBar.style.width = `${state.readings.lel.bar}%`;
            lelBar.style.backgroundColor = state.readings.lel.color;
            h2sValue.textContent = `${state.readings.h2s.value} ${state.readings.h2s.unit}`;
            h2sBar.style.width = `${state.readings.h2s.bar}%`;
            h2sBar.style.backgroundColor = state.readings.h2s.color;
            coValue.textContent = `${state.readings.co.value} ${state.readings.co.unit}`;
            coBar.style.width = `${state.readings.co.bar}%`;
            coBar.style.backgroundColor = state.readings.co.color;
            startDemoBtn.textContent = state.isDemoRunning ? 'Hentikan Demo' : 'Mulai Demo';
            resultVolume.textContent = `${state.calculator.volume.toFixed(2)} m³`;
            resultFlowRec.textContent = `${state.calculator.flowM3.toFixed(2)} m³/jam`;
            resultCfmRec.textContent = `(setara ${state.calculator.flowCFM.toFixed(1)} CFM)`;
            resultFlowMin.textContent = `${state.calculator.flowM3_min.toFixed(2)} m³/jam`;
            resultCfmMin.textContent = `(setara ${state.calculator.flowCFM_min.toFixed(1)} CFM)`;
        }
        
        function renderCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            const { width, height } = rect;
            ctx.clearRect(0, 0, width, height);
            const tank = { x: width * 0.1, y: height * 0.05, width: width * 0.8, height: height * 0.9 };
            ctx.fillStyle = colors.tank;
            ctx.strokeStyle = colors.tankBorder;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.rect(tank.x, tank.y, tank.width, tank.height);
            ctx.fill();
            ctx.stroke();
            drawGasIconsOnCanvas(rect, tank);
            if (state.probeHeight > 0) drawProbeOnCanvas(rect, tank);
            if (state.isVentilating) {
                drawVentilatorOnCanvas(rect, tank);
                drawVentilationParticles(rect, tank);
            }
        }

        function drawGasIconsOnCanvas(rect, tank) {
            const floatOffset = Math.sin(state.iconAnimationPhase) * (rect.height * 0.008);
            const scaleEffect = 1 + Math.abs(Math.sin(state.iconAnimationPhase)) * 0.15;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const tankCenterX = tank.x + tank.width / 2;
            const iconFont = `bold ${rect.width * 0.1 * scaleEffect}px Segoe UI`;
            if (state.showCH4) {
                const iconY = tank.y + tank.height / 6 + floatOffset;
                ctx.font = iconFont;
                ctx.fillStyle = colors.danger;
                ctx.fillText('CH₄', tankCenterX, iconY);
            }
            if (state.showCO) {
                const iconY = tank.y + tank.height / 2 + floatOffset;
                ctx.font = iconFont;
                ctx.fillStyle = colors.warning;
                ctx.fillText('CO', tankCenterX, iconY);
            }
            if (state.showH2S) {
                const iconY = tank.y + tank.height * 5 / 6 + floatOffset;
                ctx.font = iconFont;
                ctx.fillStyle = colors.danger;
                ctx.fillText('H₂S', tankCenterX, iconY);
            }
        }

        function drawProbeOnCanvas(rect, tank) {
            ctx.fillStyle = '#333';
            ctx.fillRect(tank.x + (tank.width * 0.1), tank.y, 8, state.probeHeight * tank.height);
        }
        
        function drawVentilatorOnCanvas(rect, tank) {
            const blowerX = tank.x + tank.width - (tank.width * 0.15);
            const blowerY = tank.y - (tank.height * 0.05);
            ctx.strokeStyle = colors.hose;
            ctx.lineWidth = 10;
            ctx.beginPath();
            ctx.moveTo(blowerX, blowerY);
            ctx.lineTo(blowerX, tank.y + tank.height * 0.85);
            ctx.stroke();
            ctx.save();
            ctx.translate(blowerX, blowerY);
            ctx.rotate(state.ventilatorAngle);
            ctx.font = `bold ${rect.width * 0.15}px Segoe UI`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('⚙️', 0, 0);
            ctx.restore();
        }

        function initVentilationParticles(rect, tank) {
            state.particles = [];
            for (let i = 0; i < 80; i++) {
                state.particles.push({
                    x: tank.x + Math.random() * tank.width,
                    y: tank.y + Math.random() * tank.height,
                    size: Math.random() * 2 + 1,
                    vx: (Math.random() - 0.5) * 0.2,
                    vy: -(Math.random() * 0.3 + 0.1),
                    type: 'dirty'
                });
            }
        }
        
        function drawVentilationParticles(rect, tank) {
            if (Math.random() > 0.3) {
                state.particles.push({
                    x: tank.x + tank.width - (tank.width * 0.15),
                    y: tank.y, size: Math.random() * 3 + 2, vx: 0, vy: 1.5, type: 'clean'
                });
            }
            for (let i = state.particles.length - 1; i >= 0; i--) {
                const p = state.particles[i];
                p.x += p.vx;
                p.y += p.vy;
                if (p.type === 'clean' && p.y > tank.y + tank.height * 0.85) {
                    p.vy = (Math.random() - 0.5) * 0.5;
                    p.vx = (Math.random() - 1) * 0.5;
                } else if (p.type === 'dirty') {
                    if (p.y > tank.y + tank.height * 0.6) { p.vy -= 0.02; }
                    if (p.y < tank.y + tank.height * 0.2) { p.vx -= 0.05; }
                }
                if (p.y < tank.y - 10 || p.x < tank.x - 10 || p.x > tank.x + tank.width + 10) {
                    state.particles.splice(i, 1);
                }
                ctx.fillStyle = p.type === 'clean' ? colors.airClean : colors.airDirty;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateCalculations() {
            const p = parseFloat(inputPanjang.value) || 0;
            const l = parseFloat(inputLebar.value) || 0;
            const t = parseFloat(inputTinggi.value) || 0;
            const volume = p * l * t;
            const flowM3 = volume * 10;
            const flowM3_min = volume * 5;
            const cfmFactor = 0.588578;
            state.calculator = {
                panjang: p, lebar: l, tinggi: t, volume, flowM3, flowM3_min,
                flowCFM: flowM3 * cfmFactor, flowCFM_min: flowM3_min * cfmFactor
            };
            updateUI();
        }

        function animate() {
            let needsRender = false;
            if (state.isDemoRunning || state.isVentilating) {
                if (state.isVentilating) state.ventilatorAngle += 0.1;
                state.iconAnimationPhase += 0.1;
                needsRender = true;
            }
            if (needsRender) renderCanvas();
            requestAnimationFrame(animate);
        }

        function startDemo() {
            if (state.isDemoRunning) return;
            state.isDemoRunning = true;
            updateUI();
            runDemoStep(1);
        }
        
        function doResetAndStopDemo() {
            clearTimeout(state.demoTimeoutId);
            const calcState = { ...state.calculator };
            state = getInitialState();
            state.calculator = calcState;
            inputPanjang.value = calcState.panjang;
            inputLebar.value = calcState.lebar;
            inputTinggi.value = calcState.tinggi;
            textCH4.classList.remove('visible');
            textCO.classList.remove('visible');
            textH2S.classList.remove('visible');
            updateUI();
            renderCanvas();
        }
        
        function runDemoStep(step) {
            if (!state.isDemoRunning) return;
            const rect = canvas.getBoundingClientRect();
            const tank = { width: rect.width * 0.8, height: rect.height * 0.9 };
            textCH4.classList.remove('visible');
            textCO.classList.remove('visible');
            textH2S.classList.remove('visible');
            switch(step) {
                case 1:
                    state.probeHeight = 0.15;
                    state.showCH4 = true;
                    textCH4.classList.add('visible');
                    state.readings.lel = { value: 15, unit: '%', color: colors.danger, bar: 75 };
                    state.demoTimeoutId = setTimeout(() => runDemoStep(2), 2000);
                    break;
                case 2:
                    state.probeHeight = 0.5;
                    state.showCO = true;
                    textCO.classList.add('visible');
                    state.readings.o2 = { value: 18.5, unit: '%', color: colors.warning, bar: 80 };
                    state.readings.co = { value: 50, unit: 'ppm', color: colors.warning, bar: 50 };
                    state.demoTimeoutId = setTimeout(() => runDemoStep(3), 2000);
                    break;
                case 3:
                    state.probeHeight = 0.9;
                    state.showH2S = true;
                    textH2S.classList.add('visible');
                    state.readings.h2s = { value: 25, unit: 'ppm', color: colors.danger, bar: 85 };
                    state.demoTimeoutId = setTimeout(() => runDemoStep(4), 2000);
                    break;
                case 4:
                    textCH4.classList.remove('visible');
                    textCO.classList.remove('visible');
                    textH2S.classList.remove('visible');
                    initVentilationParticles(rect, tank);
                    state.isVentilating = true;
                    setTimeout(() => {
                        state.isVentilating = false;
                        state.showCH4 = false; state.showCO = false; state.showH2S = false;
                        state.probeHeight = 0;
                        state.readings = getInitialState().readings;
                        updateUI();
                    }, 8000);
                    state.demoTimeoutId = setTimeout(() => runDemoStep(5), 9000);
                    break;
                 case 5:
                    doResetAndStopDemo();
                    state.isDemoRunning = true;
                    updateUI();
                    state.demoTimeoutId = setTimeout(() => runDemoStep(1), 1500);
                    break;
            }
            updateUI();
        }
        
        window.addEventListener('resize', renderCanvas);
        startDemoBtn.addEventListener('click', () => { state.isDemoRunning ? doResetAndStopDemo() : startDemo(); });
        resetBtn.addEventListener('click', doResetAndStopDemo);
        [inputPanjang, inputLebar, inputTinggi].forEach(input => input.addEventListener('input', updateCalculations));
        
        state = getInitialState();
        updateCalculations();
        updateUI();
        window.onload = () => {
            renderCanvas();
            animate();
        };
    </script>
</body>
</html>


