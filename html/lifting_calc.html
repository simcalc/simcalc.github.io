<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Crane Mat (Pmax & CBR)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .input-group label { flex: 2; font-weight: 600; color: #1e3a8a; }
        .unit { font-size: 0.85rem; color: #6b7280; margin-left: 5px; }
        .result-box { border: 2px solid #3b82f6; background-color: #eff6ff; }
        
        /* Style untuk diagram outrigger */
        .outrigger-pad {
            width: 50px;
            height: 50px;
            border: 3px solid #2e7d32;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            position: relative;
            transition: background-color 0.3s;
            z-index: 10;
        }
        .outrigger-pad.critical-safe { background-color: #10B981; border-color: #059669; }
        .outrigger-pad.critical-unsafe { background-color: #EF4444; border-color: #DC2626; }
        .outrigger-pad.secondary { background-color: #6B7280; border-color: #4B5563; }
        
        .pmax-status { transition: color 0.3s; }

        /* Area interaktif untuk putar boom */
        #interactive-diagram-area {
            position: relative;
            cursor: default;
        }
        #interactive-diagram-area svg {
            cursor: grab;
            z-index: 20; 
        }
        #interactive-diagram-area.dragging svg {
            cursor: grabbing;
        }

        /* Canvas untuk visualisasi boom */
        #boom-canvas {
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: white;
            display: block;
            margin-top: 15px;
            width: 100%; /* Membuat canvas responsif penuh */
            height: 400px; /* Tinggi tetap agar tidak terjadi CLS */
        }

        /* Flex wrap untuk input pada layar kecil */
        @media (max-width: 640px) {
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            .input-group label {
                width: 100%;
                margin-bottom: 5px;
            }
            .input-group div {
                width: 100%;
            }
        }
        
        /* Tata letak untuk layar besar (LG+) */
        @media (min-width: 1024px) {
            /* Mengubah layout grid utama untuk menempatkan A & B di kolom kiri, dan C & D di kolom kanan */
            .main-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px; /* lg:gap-6 */
            }
            .col-left {
                display: grid;
                grid-template-rows: auto auto auto; /* Menumpuk A, B, C */
                gap: 24px;
            }
            .col-right {
                display: grid;
                grid-template-rows: auto; /* Hanya D */
                gap: 24px;
            }
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8">
    <div class="max-w-full mx-auto bg-white p-4 sm:p-6 md:p-8 rounded-xl shadow-2xl">
        <h2 class="text-2xl sm:text-3xl font-bold text-center text-blue-800 mb-4 sm:mb-6 border-b-4 border-blue-200 pb-2">
            Kalkulator Stabilitas Crane & Ukuran Mat
        </h2>

        <div class="main-grid">
            <!-- LEFT COLUMN (A & B & C) -->
            <div class="col-left">
                <!-- INPUT SECTION (A) -->
                <div class="space-y-3 sm:space-y-4">
                    <h3 class="text-lg sm:text-xl font-semibold text-blue-700 border-l-4 border-blue-500 pl-3">A. Input Data Crane & Tanah</h3>
                    
                    <div class="input-group flex items-center">
                        <label for="crane-type" class="w-1/2">Tipe Crane:</label>
                        <select id="crane-type" class="w-1/2 p-2 border border-gray-300 rounded-lg text-sm sm:text-base">
                            <option value="160">SAC1600S (160 Ton)</option>
                            <option value="250">SAC2500S (250 Ton)</option>
                        </select>
                    </div>

                    <!-- Berat Beban Bersih (Net Load) - DIPINDAHKAN KE ATAS -->
                    <div class="input-group flex items-center">
                        <label for="net-load" class="w-1/2">Berat Beban Bersih (Net Load):</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="net-load" value="20" min="1" step="0.1" class="p-2 border border-gray-300 rounded-l-lg w-full text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">Ton</span>
                        </div>
                    </div>

                    <!-- Input Counterweight (Dropdown) -->
                    <div class="input-group flex items-center">
                        <label for="counterweight" class="w-1/2">Berat Counterweight (CW):</label>
                        <div class="w-1/2 flex items-center">
                            <select id="counterweight" class="p-2 border border-gray-300 rounded-lg w-full text-sm sm:text-base">
                                <option value="52">52 Ton (160T)</option>
                                <option value="43">43 Ton (160T)</option>
                                <option value="32.5">32.5 Ton (160T)</option>
                                <option value="20.5">20.5 Ton (160T/250T)</option>
                                <option value="17.5">17.5 Ton (160T)</option>
                                <option value="9.5">9.5 Ton (160T)</option>
                                <option value="1.5">1.5 Ton (160T)</option>
                                <!-- Opsi 250T ditambahkan di JS jika dipilih -->
                            </select>
                        </div>
                    </div>

                    <!-- Input Panjang Boom BARU -->
                    <div class="input-group flex items-center">
                        <label for="boom-length-number" class="w-1/2">Panjang Boom (L):</label>
                        <div class="w-1/2 flex items-center">
                            <input type="range" id="boom-length-slider" min="13.6" max="73" step="0.1" class="w-2/3 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <input type="number" id="boom-length-number" min="13.6" max="73" step="0.1" class="w-1/3 p-2 border border-gray-300 rounded-r-lg text-sm sm:text-base">
                        </div>
                    </div>
                    
                    <div class="input-group flex items-center">
                        <label for="radius" class="w-1/2">Radius Operasi (R):</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="radius" value="18" min="3" step="0.1" class="p-2 border border-gray-300 rounded-l-lg w-full text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">m</span>
                        </div>
                    </div>

                    <div class="input-group flex items-center">
                        <label for="cbr" class="w-1/2">Rencana CBR Tanah:</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="cbr" value="30" min="5" max="100" step="1" class="p-2 border border-gray-300 rounded-l-lg w-full text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">%</span>
                        </div>
                    </div>

                    <div class="input-group flex items-center">
                        <label for="daft" class="w-1/2">Faktor Beban Dinamis (DAF):</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="daft" value="1.25" min="1.0" max="1.5" step="0.01" class="p-2 border border-gray-300 rounded-l-lg w-full text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">x</span>
                        </div>
                    </div>

                    <!-- Input BARU: Lebar Outrigger Pad -->
                    <div class="input-group flex items-center">
                        <label for="pad-diameter" class="w-1/2">Lebar Outrigger Pad (d_pad):</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="pad-diameter" value="0.6" min="0.2" max="2.0" step="0.1" class="p-2 border border-gray-300 rounded-l-lg w-full text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">m</span>
                        </div>
                    </div>
                    
                    <div class="input-group flex items-center p-2 rounded-lg" id="pmax-calc-group">
                        <label for="pmax-calc" class="w-1/2">Pmax Hasil Kalkulasi:</label>
                        <div class="w-1/2 flex items-center">
                            <input type="number" id="pmax-calc" value="28.4" min="10" step="0.1" readonly class="p-2 border border-gray-300 rounded-l-lg w-full bg-gray-200 font-bold pmax-status text-sm sm:text-base">
                            <span class="unit bg-gray-200 p-2 rounded-r-lg">Ton</span>
                        </div>
                    </div>
                </div>

                <!-- RESULT SECTION (B) -->
                <div id="results" class="space-y-3 sm:space-y-4 result-box p-3 sm:p-4 rounded-xl shadow-lg">
                    <h3 class="text-lg sm:text-xl font-semibold text-blue-700 border-l-4 border-blue-500 pl-3">B. Hasil & Rekomendasi</h3>
                    
                    <p class="font-medium text-sm sm:text-lg text-gray-800">0. Pmax Final (Input Desain Mat): <span id="final-pmax-value" class="font-extrabold text-red-900 pmax-status"></span> Ton</p>
                    <!-- BARU: Rumus Pmax ditambahkan di sini -->
                    <p class="text-xs text-gray-600 mt-1 mb-2 border-b border-gray-300 pb-2" id="formula-pmax"></p>

                    <div id="gbp-result" class="bg-blue-100 p-3 rounded-lg">
                        <p class="font-medium text-sm sm:text-lg text-blue-800">1. Daya Dukung Tanah (GBP): <span id="gbp-value" class="font-extrabold text-blue-900"></span> Ton/m²</p>
                        <!-- Rumus IRC 37 -->
                        <p class="text-xs sm:text-sm text-blue-700 mt-2 border-t border-blue-200 pt-2" id="cbr-note">
                            <!-- Diisi oleh JS -->
                        </p>
                    </div>
                    
                    <div id="mat-result" class="bg-yellow-100 p-3 rounded-lg">
                        <p class="font-medium text-sm sm:text-lg text-yellow-800">2. Luas Mat Minimum (A_req): <span id="area-required" class="font-extrabold text-yellow-900"></span> m²</p>
                        <p class="font-medium text-sm sm:text-lg text-yellow-800">3. Rekomendasi Steel Plate (Per Titik): <span id="mat-dimension" class="font-extrabold text-yellow-900"></span> m x m</p>
                        
                        <!-- RUMUS BARU DITAMBAHKAN DI SINI -->
                        <div class="mt-2 border-t border-yellow-300 pt-2 space-y-1">
                            <p class="text-xs text-yellow-700" id="formula-area"></p>
                            <p class="text-xs text-yellow-700" id="formula-side"></p>
                            <p class="text-xs text-yellow-700" id="formula-thickness"></p>
                        </div>
                    </div>

                    <!-- Status Keamanan Ganda (Tanah & Angkat) -->
                    <!-- PERBAIKAN: Menghapus stray '||' dari sini -->
                    <div id="pressure-check" class="p-3 rounded-lg">
                        <p class="font-medium text-sm sm:text-lg text-gray-800">4. Tekanan Aktual ke Tanah: <span id="actual-pressure" class="font-extrabold"></span> Ton/m²</p>
                        <p class="text-xs sm:text-sm" id="safety-status"></p>
                    </div>
                </div>
                
                <!-- OUTRIGGER FORCE SECTION (C) -->
                <div>
                    <h3 class="text-lg sm:text-xl font-semibold text-blue-700 border-l-4 border-blue-500 pl-3 mb-4">C. Analisis Beban Outrigger (Titik Kritis Swing)</h3>
                    <p class="text-sm sm:text-base text-gray-700">Pmax adalah hasil dari total momen jungkir. **Klik dan geser** panah *boom* di dalam diagram untuk mensimulasikan *swing* dan melihat beban kritis bergeser!</p>

                    <div class="flex flex-col items-center mt-4 p-4 border border-gray-300 rounded-lg">
                        <!-- Diagram Outrigger & Forces -->
                        <div id="interactive-diagram-area" class="relative w-full max-w-sm h-48 border-2 border-dashed border-gray-400 rounded-lg">
                            <div class="absolute top-4 left-4 flex flex-col items-center">
                                <div id="outrigger-D" class="outrigger-pad secondary">D</div>
                                <span class="mt-1 text-xs sm:text-sm font-bold text-gray-700" id="force-d">P_D: 0 Ton</span>
                            </div>

                            <div class="absolute top-4 right-4 flex flex-col items-center">
                                <div id="outrigger-C" class="outrigger-pad secondary">C</div>
                                <span class="mt-1 text-xs sm:text-sm font-bold text-red-600" id="force-c">P_C: 0 Ton</span>
                            </div>
                            
                            <div class="absolute bottom-4 left-4 flex flex-col items-center">
                                <div id="outrigger-A" class="outrigger-pad secondary">A</div>
                                <span class="mt-1 text-xs sm:text-sm font-bold text-gray-700" id="force-a">P_A: 0 Ton</span>
                            </div>
                            
                            <div class="absolute bottom-4 right-4 flex flex-col items-center">
                                <div id="outrigger-B" class="outrigger-pad secondary">B</div>
                                <span class="mt-1 text-xs sm:text-sm font-bold text-gray-700" id="force-b">P_B: 0 Ton</span>
                            </div>

                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-xl sm:text-2xl font-bold text-gray-500">CRANE</div>
                            
                            <!-- Boom Direction Indicator (Rotated by JS) -->
                            <svg id="boom-svg" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" width="100%" height="100%" viewBox="0 0 100 100" style="overflow: visible;">
                                <line id="boom-indicator" x1="50" y1="50" x2="80" y2="20" stroke="#004d99" stroke-width="2" marker-end="url(#arrowhead)"/>
                                <defs>
                                    <marker id="arrowhead" markerWidth="5" markerHeight="5" refX="5" refY="2.5" orient="auto">
                                        <polygon points="0 0, 5 2.5, 0 5" fill="#004d99" />
                                    </marker>
                                </defs>
                                <text x="65" y="15" fill="#004d99" font-weight="bold" font-size="6">Boom</text>
                            </svg>
                        </div>
                        <p class="mt-4 text-xs sm:text-sm text-center text-gray-500">A, B, C, D adalah 4 titik outrigger.</p>
                        <p class="mt-1 text-xs text-center text-gray-500">Sudut Boom (Utara=0°, Searah Jarum Jam): <span id="current-angle" class="font-bold text-blue-700">45.0°</span></p>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN (D) -->
            <div class="col-right mt-6 lg:mt-0">
                
                <!-- BOOM OPERATING RANGE SECTION (D) -->
                <div>
                    <h3 class="text-lg sm:text-xl font-semibold text-blue-700 border-l-4 border-blue-500 pl-3 mb-4">D. Pengaruh Ketinggian Boom (Gaya Gravitasi)</h3>

                    <div id="load-chart-display" class="mt-4 p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <h4 class="font-semibold text-lg text-blue-700 mb-2" id="load-chart-title">Visualisasi Jangkauan Boom (SAC1600S)</h4>
                        <p class="text-sm text-gray-600 mb-3">Gunakan diagram ini untuk memvisualisasikan **Radius (R)** dan **Panjang Boom (L)** Anda. Garis merah menunjukkan radius, garis biru menunjukkan *boom*.</p>
                        
                        <!-- CANVAS untuk Boom Diagram Interaktif -->
                        <canvas id="boom-canvas" width="600" height="400"></canvas>
                        <p class="text-xs text-gray-600 mt-2">Titik pusat adalah *pivot crane*.</p>
                    </div>
                    
                    <p class="text-sm sm:text-base text-gray-700 mt-4">Pengaruh ketinggian (*boom angle*) dan panjang *boom* terhadap beban *outrigger* dihitung berdasarkan **Momen Jungkir ($M$)**. $P_{\text{max}}$ yang kami hitung sudah mencakup semua **gaya vertikal ke bawah (Gravitasi)** ditambah **efek momen jungkir** yang berusaha menggulingkan *crane*. </p>
                    <p class="text-sm sm:text-base text-gray-700 mt-2">**Kondisi Kritis:** Semakin rendah sudut *boom* (mendekati horizontal), semakin besar *Radius* $(R)$. Karena $M \propto \text{Gaya Vertikal} \times R$, peningkatan *Radius* akan secara eksponensial **meningkatkan Momen Jungkir**. Peningkatan momen ini langsung **meningkatkan $P_{\text{max}}$** pada *outrigger* yang menahan beban. Oleh karena itu, skenario *lift* pada radius terjauh adalah basis desain yang paling tepat untuk *mat*.</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Data Statis Crane (Estimasi konservatif)
        const CRANE_DATA = {
            '160': { 
                CW_DEFAULT: 32.5, 
                R_CRITICAL: 18,    
                R_CW_CRITICAL: 4,  
                R_TIPPING_LINE: 4.05, 
                W_CRANE_BODY: 57, 
                W_HOOK_RIGGING: 1.0, 
                Pmax_DEFAULT: 28.4,
                MAX_RADIUS: 65, 
                MAX_HEIGHT: 75, 
                BOOM_LENGTHS: [13.6, 22.8, 32, 40.9, 50.1, 59.3, 73] 
            }, 
            '250': { 
                CW_DEFAULT: 62.0, // Menggunakan 62T sebagai default
                R_CRITICAL: 24,
                R_CW_CRITICAL: 4.5,
                R_TIPPING_LINE: 4.25, 
                W_CRANE_BODY: 60,
                W_HOOK_RIGGING: 1.5,
                Pmax_DEFAULT: 53.6,
                MAX_RADIUS: 70, 
                MAX_HEIGHT: 75, 
                BOOM_LENGTHS: [13.8, 22.7, 31.6, 40.5, 53.8, 67.1, 73] 
            }
        };

        //---------------------------------------------------------
        // DATA LOAD CHART (BARU: Ditambahkan data untuk semua CW)
        //---------------------------------------------------------
        
        // SAC1600S (52T) - PDF Hal 11
        const SAC1600S_LOAD_CHART_52T = {
            "13.6": { "2.5": 160, "3": 130, "3.5": 126, "4": 117, "4.5": 109, "5": 100, "6": 87, "7": 75, "8": 66, "9": 58, "10": 49 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 95, "5": 91, "6": 85, "7": 76, "8": 66, "9": 60, "10": 55, "12": 45, "14": 35.5, "16": 29, "18": 24, "20": 19.5, "22": 18 },
            "32": { "5": 85, "6": 78, "7": 70, "8": 63, "9": 57, "10": 52, "12": 43.5, "14": 34, "16": 27.2, "18": 22.5, "20": 19.5, "22": 18, "24": 17, "26": 15 },
            "40.9": { "7": 62, "8": 51.5, "9": 49, "10": 46, "12": 41, "14": 36, "16": 29.5, "18": 24.5, "20": 21, "22": 18, "24": 16, "26": 14, "28": 12.2, "30": 11, "32": 10.2, "34": 9.5 },
            "50.1": { "9": 35.5, "10": 28.5, "12": 25.5, "14": 23, "16": 20.5, "18": 18.5, "20": 17, "22": 15.2, "24": 14, "26": 12.5, "28": 11.5, "30": 10, "32": 9, "34": 8.3, "36": 7.5, "38": 7, "40": 6.3, "42": 6, "44": 5 },
            "59.3": { "12": 22.5, "14": 20, "16": 18, "18": 16.5, "20": 15, "22": 14, "24": 12.5, "26": 11.5, "28": 11, "30": 10, "32": 8.2, "34": 7.5, "36": 7, "38": 6.3, "40": 5.6, "42": 5.3, "44": 5, "46": 4.6, "48": 4.3, "50": 4, "52": 3.6 },
            "73": { "16": 9, "18": 9, "20": 8.8, "22": 8.5, "24": 8.2, "26": 7.8, "28": 7.5, "30": 6.8, "32": 6.5, "34": 6, "36": 5.6, "38": 5.2, "40": 4.8, "42": 4.5, "44": 4.2, "46": 3.9, "48": 3.6, "50": 3.3, "52": 3, "54": 2.7, "56": 2.3, "58": 2, "60": 1.7, "62": 1.3 }
        };

        // SAC1600S (43T) - PDF Hal 12
        const SAC1600S_LOAD_CHART_43T = {
            "13.6": { "3": 130, "3.5": 126, "4": 117, "4.5": 109, "5": 100, "6": 87, "7": 74, "8": 63, "9": 55, "10": 48 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 95, "5": 91, "6": 85, "7": 76, "8": 63, "9": 55, "10": 50, "12": 40.5, "14": 32, "16": 26, "18": 21.5 },
            "32": { "5": 85, "6": 78, "7": 70, "8": 63, "9": 55, "10": 50, "12": 39, "14": 30.5, "16": 25, "18": 22, "20": 19, "22": 17.2, "24": 15, "26": 13.3 },
            "40.9": { "7": 62, "8": 51.5, "9": 49, "10": 46, "12": 41, "14": 32.5, "16": 26.5, "18": 22.1, "20": 18.7, "22": 16.1, "24": 14, "26": 12.5, "28": 11.5, "30": 10.5, "32": 9.5, "34": 8.5 },
            "50.1": { "9": 35.5, "10": 28.5, "12": 25.5, "14": 23, "16": 20.5, "18": 18.5, "20": 16.8, "22": 15, "24": 13.2, "26": 11.5, "28": 10.5, "30": 9.5, "32": 8.5, "34": 7.6, "36": 7.2, "38": 6.6, "40": 6, "42": 5.5, "44": 4.8 },
            "59.3": { "12": 22.5, "14": 20, "16": 18, "18": 16.5, "20": 15, "22": 14, "24": 12.5, "26": 11.5, "28": 10.2, "30": 9, "32": 8, "34": 7, "36": 6.5, "38": 6, "40": 5.6, "42": 5.3, "44": 4.6, "46": 4.3, "48": 4, "50": 3.6, "52": 3 },
            "73": { "16": 9, "18": 9, "20": 8.8, "22": 8.5, "24": 8.2, "26": 7.8, "28": 7.5, "30": 6.8, "32": 6.5, "34": 6, "36": 5.6, "38": 5.2, "40": 4.8, "42": 4.5, "44": 4, "46": 3.5, "48": 3, "50": 2.7, "52": 2.3, "54": 2.1, "56": 1.8, "58": 1.5, "60": 1.2 }
        };
        
        // SAC1600S (32.5T) - PDF Hal 13
        const SAC1600S_LOAD_CHART_32_5T = {
            "13.6": { "3": 130, "3.5": 126, "4": 115, "4.5": 108, "5": 97, "6": 80, "7": 67, "8": 58, "9": 49, "10": 41 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 93, "5": 91, "6": 77, "7": 65, "8": 58, "9": 48, "10": 41.5, "12": 30.6, "14": 23.7, "16": 19, "18": 15.7 },
            "32": { "5": 82, "6": 76, "7": 65, "8": 57, "9": 48.7, "10": 42.2, "12": 32.5, "14": 25.6, "16": 20.8, "18": 17.3, "20": 14.7, "22": 12.6, "24": 11 },
            "40.9": { "7": 53, "8": 42, "9": 42, "10": 40, "12": 31.5, "14": 24.5, "16": 20, "18": 17.5, "20": 14.7, "22": 12.6, "24": 11, "26": 9.5, "28": 8.4, "30": 7.4, "32": 6.6, "34": 5.8 },
            "50.1": { "9": 35, "10": 28, "12": 25, "14": 22, "16": 18.5, "18": 16, "20": 13.3, "22": 11.5, "24": 10.5, "26": 9.2, "28": 8, "30": 6.9, "32": 6, "34": 5.2, "36": 4.5, "38": 3.9, "40": 3.4, "42": 2.9, "44": 2.5 },
            "59.3": { "12": 22, "14": 20, "16": 18, "18": 15, "20": 13, "22": 11.5, "24": 10, "26": 9, "28": 7.8, "30": 6.8, "32": 6, "34": 5.2, "36": 4.6, "38": 4, "40": 3.5, "42": 3, "44": 2.6, "46": 2.1, "48": 1.8, "50": 1.5 },
            "73": { "16": 9, "18": 9, "20": 8.8, "22": 8.5, "24": 8.2, "26": 7.6, "28": 7, "30": 6, "32": 5.2, "34": 4.5, "36": 3.8, "38": 3.2, "40": 2.6, "42": 2.1, "44": 1.7, "46": 1.3, "48": 1 }
        };

        // SAC1600S (20.5T) - PDF Hal 14
        const SAC1600S_LOAD_CHART_20_5T = {
            "13.6": { "3": 130, "3.5": 126, "4": 115, "4.5": 107, "5": 95, "6": 79, "7": 66, "8": 50, "9": 40, "10": 33 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 93, "5": 91, "6": 76, "7": 63, "8": 50, "9": 40, "10": 34, "12": 25, "14": 19, "16": 15 },
            "32": { "5": 82, "6": 76, "7": 63, "8": 50, "9": 44, "10": 37, "12": 27, "14": 21.5, "16": 17.2, "18": 14.2, "20": 12, "22": 10.5, "24": 9 },
            "40.9": { "7": 53, "8": 42, "9": 42, "10": 35, "12": 26, "14": 21.5, "16": 17.5, "18": 14.5, "20": 12, "22": 10, "24": 8.8, "26": 7.6, "28": 6.6, "30": 5.8, "32": 5.1, "34": 4.5 },
            "50.1": { "9": 35, "10": 28, "12": 25.5, "14": 21, "16": 16, "18": 14, "20": 11.8, "22": 10, "24": 8.7, "26": 7.5, "28": 6.5, "30": 5.7, "32": 4.9, "34": 4.2, "36": 3.6, "38": 3.1, "40": 2.6, "42": 2.1, "44": 1.8 },
            "59.3": { "12": 22, "14": 20, "16": 15.6, "18": 14, "20": 12, "22": 10.5, "24": 8.8, "26": 7.6, "28": 6.6, "30": 5.7, "32": 5, "34": 4.3, "36": 3.7, "38": 3.1, "40": 2.7, "42": 2.2, "44": 1.9, "46": 1.5, "48": 1.2, "50": 1 },
            "73": { "16": 9, "18": 9, "20": 8.8, "22": 8.5, "24": 8.2, "26": 7, "28": 6, "30": 5.1, "32": 4.3, "34": 3.5, "36": 2.9, "38": 2.3, "40": 1.8, "42": 1.4, "44": 1 }
        };

        // SAC1600S (17.5T) - PDF Hal 15
        const SAC1600S_LOAD_CHART_17_5T = {
            "13.6": { "3": 130, "3.5": 126, "4": 115, "4.5": 103, "5": 92, "6": 75, "7": 62, "8": 49.2, "9": 39.5, "10": 32.5 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 93, "5": 90, "6": 73, "7": 62, "8": 48, "9": 40, "10": 33.6, "12": 24.5, "14": 18.5, "16": 14.5 },
            "32": { "5": 82, "6": 72, "7": 62, "8": 48.3, "9": 38.5, "10": 35, "12": 26.5, "14": 20.5, "16": 16.3, "18": 13.3, "20": 11.1, "22": 9.5, "24": 8 },
            "40.9": { "7": 53, "8": 42, "9": 41.5, "10": 34.5, "12": 25.5, "14": 20.5, "16": 16, "18": 13, "20": 10.7, "22": 8.8, "24": 7.3, "26": 6.2, "28": 5.5, "30": 4.6, "32": 3.9, "34": 3.3 },
            "50.1": { "9": 35, "10": 28, "12": 23.5, "14": 19, "16": 15.5, "18": 12.5, "20": 10.5, "22": 8.5, "24": 7, "26": 6, "28": 5, "30": 4.1, "32": 3.4, "34": 2.8, "36": 2.2, "38": 1.7, "40": 1.3 },
            "59.3": { "12": 18.5, "14": 18, "16": 15.5, "18": 12.6, "20": 10.5, "22": 8.6, "24": 7.2, "26": 6, "28": 5, "30": 4.2, "32": 3.5, "34": 2.9, "36": 2.3, "38": 1.9, "40": 1.5, "42": 1.2 },
            "73": { "16": 9, "18": 9, "20": 8.8, "22": 8, "24": 6.5, "26": 5.3, "28": 4.3, "30": 3.5, "32": 2.7, "34": 2, "36": 1.5, "38": 1.1 }
        };

        // SAC1600S (9.5T) - PDF Hal 16
        const SAC1600S_LOAD_CHART_9_5T = {
            "13.6": { "3": 130, "3.5": 120, "4": 105, "4.5": 96, "5": 82, "6": 69, "7": 50, "8": 38, "9": 30, "10": 24.5 },
            "22.8": { "3.5": 95, "4": 95, "4.5": 88, "5": 78, "6": 68, "7": 49, "8": 38.5, "9": 30.5, "10": 24.5, "12": 17, "14": 12, "16": 9.2 },
            "32": { "5": 78, "6": 67, "7": 48.5, "8": 41, "9": 32.8, "10": 27.2, "12": 19.3, "14": 14.7, "16": 11.3, "18": 9, "20": 7.2, "22": 5.8, "24": 4.8 },
            "40.9": { "7": 48, "8": 39.5, "9": 31.5, "10": 27, "12": 19.5, "14": 14.5, "16": 11.2, "18": 8.7, "20": 7, "22": 5.5, "24": 4.5, "26": 3.5, "28": 2.7, "30": 2.1, "32": 1.6 },
            "50.1": { "9": 30, "10": 25, "12": 18, "14": 14.5, "16": 11, "18": 8.3, "20": 6.5, "22": 5.2, "24": 4.1, "26": 3.1, "28": 2.5, "30": 1.8, "32": 1.3 },
            "59.3": { "12": 18.5, "14": 14, "16": 11.2, "18": 8.6, "20": 7, "22": 5.5, "24": 4.3, "26": 3.4, "28": 2.5, "30": 2, "32": 1.5, "34": 1.1 },
            "73": { "16": 9, "18": 8, "20": 6.3, "22": 5, "24": 3.8, "26": 2.8, "28": 2, "30": 1.3 }
        };
        
        //---------------------------------------------------------
        // DATA LOAD CHART SAC2500S (BARU DITAMBAHKAN)
        //---------------------------------------------------------

        // SAC2500S (62T) - PDF Hal 11
        const SAC2500S_LOAD_CHART_62T = {
            "13.8": { "3": 220, "3.5": 160, "4": 150, "4.5": 145, "5": 135, "6": 120, "7": 106, "8": 94.5, "9": 83.5, "10": 72 },
            "22.7": { "4": 140, "4.5": 132, "5": 123, "6": 110, "7": 99, "8": 90, "9": 82, "10": 70, "12": 53.5, "14": 42.5, "16": 35, "18": 29.5 },
            "31.6": { "5": 105, "6": 101, "7": 95, "8": 87, "9": 79.3, "10": 70, "12": 53, "14": 42.2, "16": 34.5, "18": 29.3, "20": 25, "22": 21.7, "24": 19 },
            "40.5": { "7": 85, "8": 65, "9": 62, "10": 59, "12": 53, "14": 45, "16": 38, "18": 32, "20": 27, "22": 23, "24": 21, "26": 18, "28": 16, "30": 14.5, "32": 13, "34": 11.8 },
            "53.8": { "11": 35, "12": 32.2, "14": 28.8, "16": 25.6, "18": 23.2, "20": 21.3, "22": 19.5, "24": 18, "26": 16.4, "28": 14.3, "30": 12.6, "32": 11.5, "34": 10.6, "36": 9.5, "38": 9, "40": 8.5, "42": 8, "44": 7, "46": 6.5, "48": 5, "50": 5.3 },
            "67.1": { "16": 18.1, "18": 17, "20": 15.9, "22": 14.9, "24": 14, "26": 13.1, "28": 12.3, "30": 11.4, "32": 10.7, "34": 10, "36": 9.3, "38": 8.6, "40": 8, "42": 7.2, "44": 6.9, "46": 6.4, "48": 5.9, "50": 5.4, "52": 5, "54": 4.6, "56": 4, "58": 2.9, "60": 2.6 },
            "73": { "18": 13.4, "20": 12.5, "22": 12, "24": 11, "26": 10.5, "28": 10, "30": 9.4, "32": 8.8, "34": 8.4, "36": 7.9, "38": 7.5, "40": 7, "42": 6, "44": 5.5, "46": 5, "48": 5, "50": 4.5, "52": 4.2, "54": 3.8, "56": 3.4, "58": 3, "60": 2.6, "62": 2.3 }
        };
        
        // SAC2500S (50.5T) - PDF Hal 12
        const SAC2500S_LOAD_CHART_50_5T = {
            "13.8": { "3": 160, "3.5": 155, "4": 150, "4.5": 140, "5": 130, "6": 115, "7": 102.5, "8": 80, "9": 70, "10": 63 },
            "22.7": { "4": 140, "4.5": 132, "5": 123, "6": 110, "7": 99, "8": 90, "9": 82, "10": 70, "12": 51, "14": 41, "16": 33.5, "18": 27.5 },
            "31.6": { "5": 105, "6": 101, "7": 95, "8": 87, "9": 79.3, "10": 68, "12": 51, "14": 40.2, "16": 33, "18": 28.3, "20": 23.6, "22": 19.9, "24": 17 },
            "40.5": { "7": 85, "8": 65, "9": 62, "10": 59, "12": 53, "14": 44, "16": 37, "18": 31, "20": 26, "22": 22, "24": 19, "26": 16.5, "28": 15, "30": 13.5, "32": 11.5, "34": 9.6 },
            "53.8": { "11": 33.1, "12": 32.2, "14": 28.8, "16": 25.6, "18": 23.2, "20": 21.3, "22": 19.5, "24": 18, "26": 15.5, "28": 13.6, "30": 12.5, "32": 11, "34": 9.5, "36": 8.5, "38": 8, "40": 7, "42": 6, "44": 5.2, "46": 4.5, "48": 4, "50": 4.8 }, // Ambiguitas 50m (4.8T), saya ambil 4.8T
            "67.1": { "16": 18.1, "18": 17, "20": 15.9, "22": 14.9, "24": 14, "26": 13.1, "28": 12.3, "30": 11.4, "32": 10.7, "34": 10, "36": 9.3, "38": 8.6, "40": 7.3, "42": 6.6, "44": 5.8, "46": 5.1, "48": 4.6, "50": 4, "52": 3.5, "54": 3.1, "56": 2.6, "58": 2.3, "60": 1.8 },
            "73": { "18": 13.4, "20": 12.5, "22": 12, "24": 11, "26": 10.5, "28": 10, "30": 9.4, "32": 8.8, "34": 8, "36": 7.5, "38": 6.5, "40": 5.8, "42": 5.1, "44": 4.4, "46": 3.9, "48": 3.3, "50": 2.9, "52": 2.4, "54": 1.9, "56": 1.4, "58": 1.2 }
        };
        
        // SAC2500S (40.5T) - PDF Hal 13
        const SAC2500S_LOAD_CHART_40_5T = {
            "13.8": { "3": 150, "3.5": 150, "4": 150, "4.5": 140, "5": 125, "6": 105, "7": 90, "8": 76.5, "9": 68, "10": 60 },
            "22.7": { "4": 140, "4.5": 132, "5": 123, "6": 100, "7": 88.5, "8": 75, "9": 69, "10": 60, "12": 45.2, "14": 34.9, "16": 28.2, "18": 25.5 },
            "31.6": { "5": 101, "6": 101, "7": 87, "8": 77, "9": 68.3, "10": 60.6, "12": 47, "14": 36.9, "16": 29.3, "18": 24.8, "20": 20.6, "22": 17.2, "24": 14.5 },
            "40.5": { "7": 85, "8": 65, "9": 62, "10": 59, "12": 48.2, "14": 37.8, "16": 32.1, "18": 26.6, "20": 22.4, "22": 19, "24": 16.4, "26": 14.2, "28": 12.3, "30": 10.8, "32": 9.5, "34": 8.3 },
            "53.8": { "11": 33.1, "12": 32.2, "14": 28.8, "16": 25.6, "18": 23.2, "20": 21.3, "22": 18.2, "24": 16.2, "26": 14.1, "28": 12.3, "30": 10.8, "32": 9.5, "34": 7.8, "36": 6.8, "38": 5.9, "40": 5.2, "42": 4.5, "44": 3.8, "46": 3.2, "48": 3.9 }, // 48m = 3.9T
            "67.1": { "16": 18.1, "18": 17, "20": 15.9, "22": 14.9, "24": 14, "26": 13.1, "28": 12.3, "30": 11.3, "32": 9.5, "34": 8.4, "36": 7.4, "38": 6.5, "40": 5.5, "42": 5, "44": 4.4, "46": 3.8, "48": 3.3, "50": 2.8, "52": 2.4, "54": 1.9, "56": 1.5, "58": 1.2 },
            "73": { "18": 13.4, "20": 12.5, "22": 12, "24": 11, "26": 10.5, "28": 9.5, "30": 8.5, "32": 7.5, "34": 6.5, "36": 5.7, "38": 4.8, "40": 4, "42": 3.4, "44": 2.8, "46": 2.3, "48": 1.9, "50": 1.4, "52": 1, "54": 0.8 }
        };

        // SAC2500S (30.5T) - PDF Hal 14
        const SAC2500S_LOAD_CHART_30_5T = {
            "13.8": { "3": 150, "3.5": 150, "4": 150, "4.5": 130, "5": 120, "6": 100, "7": 85, "8": 73.5, "9": 64, "10": 54.2 },
            "22.7": { "4": 140, "4.5": 132, "5": 123, "6": 100, "7": 88.5, "8": 72, "9": 62, "10": 52, "12": 39.4, "14": 30.7, "16": 25, "18": 21 },
            "31.6": { "5": 101, "6": 101, "7": 87, "8": 77, "9": 65.3, "10": 53.3, "12": 40.3, "14": 31.6, "16": 24.8, "18": 19.9, "20": 16.3, "22": 13.4, "24": 11.5 },
            "40.5": { "7": 85, "8": 62, "9": 60, "10": 55, "12": 43.4, "14": 33.5, "16": 26.7, "18": 21.8, "20": 18.1, "22": 15.2, "24": 12.9, "26": 11.1, "28": 9.6, "30": 8.4, "32": 7.6, "34": 7.2 },
            "53.8": { "11": 33.1, "12": 30.9, "14": 28.1, "16": 25.3, "18": 21, "20": 18, "22": 15.2, "24": 12.9, "26": 11, "28": 9.5, "30": 8.2, "32": 7, "34": 6, "36": 4.9, "38": 4.1, "40": 3.5, "42": 2.9, "44": 2.3, "46": 1.7, "48": 2.6 }, // 48m=2.6T
            "67.1": { "16": 18.1, "18": 17, "20": 15.6, "22": 13.6, "24": 12, "26": 10.4, "28": 9.1, "30": 8, "32": 7, "34": 6.1, "36": 5.4, "38": 4.7, "40": 4.1, "42": 3.5, "44": 3, "46": 2.6, "48": 2.2, "50": 1.8, "52": 1.4, "54": 1 },
            "73": { "18": 13.4, "20": 12.5, "22": 12, "24": 11, "26": 9.5, "30": 8.5, "32": 7.5, "34": 6.5, "36": 5.7, "38": 4.8, "40": 4, "42": 3.4, "44": 2.8, "46": 2.3, "48": 1.9, "50": 1.4, "52": 1 }
        };
        
        // SAC2500S (20.5T) - PDF Hal 15
        const SAC2500S_LOAD_CHART_20_5T = {
            "13.8": { "3": 150, "3.5": 150, "4": 140, "4.5": 130, "5": 120, "6": 100, "7": 85, "8": 66, "9": 55.5, "10": 45 },
            "22.7": { "4": 140, "4.5": 125, "5": 110, "6": 95, "7": 80, "8": 66.5, "9": 56, "10": 46, "12": 34.8, "14": 27.9, "16": 22.1, "18": 17.9 },
            "31.6": { "5": 100, "6": 100, "7": 77.5, "8": 62.5, "9": 50.5, "10": 42, "12": 30.2, "14": 24.7, "16": 19, "18": 16.5, "20": 14.5, "22": 13, "24": 11.1 },
            "40.5": { "7": 76, "8": 61, "9": 50.4, "10": 42.3, "12": 31, "14": 24.8, "16": 20.1, "18": 16.5, "20": 14, "22": 12, "24": 10.2, "26": 9, "28": 7.8, "30": 6.8, "32": 6, "34": 5.2 },
            "53.8": { "11": 33.1, "12": 29.9, "14": 24, "16": 19.5, "18": 16, "20": 13.3, "22": 11, "24": 9.4, "26": 8, "28": 7, "30": 5.8, "32": 4.7, "34": 3.8, "36": 3.1, "38": 2.4, "40": 1.8, "42": 1.2 },
            "67.1": { "16": 17.8, "18": 16, "20": 14.1, "22": 11.9, "24": 10, "26": 8.9, "28": 7.5, "30": 6.1, "32": 5.2, "34": 4.3, "36": 3.6, "38": 3, "40": 2.3, "42": 1.8, "44": 1.2 },
            "73": { "18": 13.4, "20": 12.5, "22": 12, "24": 10.2, "26": 9, "28": 7.5, "30": 6.3, "32": 5.4, "34": 4.4, "36": 3.6, "38": 3, "40": 2.4, "42": 1.8, "44": 1.2, "46": 0.8 }
        };

        // SAC2500S (15T) - PDF Hal 16
        const SAC2500S_LOAD_CHART_15T = {
            "13.8": { "3": 135, "3.5": 135, "4": 135, "4.5": 130, "5": 120, "6": 90, "7": 68.2, "8": 47, "9": 39.7, "10": 33.7 },
            "22.7": { "4": 135, "4.5": 125, "5": 110, "6": 80, "7": 56.4, "8": 47.7, "9": 38.4, "10": 32.8, "12": 24.3, "14": 18.5, "16": 15.3 },
            "31.6": { "5": 90, "6": 75, "7": 55.3, "8": 41.5, "9": 34.7, "10": 28.8, "12": 24, "14": 18.5, "16": 15.5, "18": 13.3, "20": 11.6, "22": 9.6, "24": 8 },
            "40.5": { "7": 60.4, "8": 46.3, "9": 36.8, "10": 30.9, "12": 22, "14": 17.4, "16": 13.7, "18": 11.4, "20": 9.4, "22": 7.8, "24": 6.5, "26": 5.5, "28": 4.7, "30": 4, "32": 3 },
            "53.8": { "11": 23.8, "12": 20.9, "14": 15.5, "16": 12.5, "18": 9.6, "20": 7.8, "22": 6.2, "24": 5, "26": 4, "28": 3.2, "30": 2.5, "32": 1.8, "34": 2, "36": 1.5 },
            "67.1": { "16": 13.5, "18": 11, "20": 9.4, "22": 7.5, "24": 6, "26": 4.8, "28": 3.7, "30": 2.9, "32": 2.1, "34": 1.5 },
            "73": { "18": 11.5, "20": 9.4, "22": 7.5, "24": 6, "26": 4.8, "28": 3.7, "30": 2.9, "32": 2.1, "34": 1.5, "36": 1.1 }
        };

        // SAC2500S (0T) - PDF Hal 17
        const SAC2500S_LOAD_CHART_0T = {
            "13.8": { "3": 130, "3.5": 130, "4": 125, "4.5": 110, "5": 100, "6": 78.5, "7": 55.6, "8": 40.5, "9": 31.5, "10": 25 },
            "22.7": { "4": 120, "4.5": 106, "5": 95, "6": 63, "7": 48.4, "8": 37.9, "9": 30.8, "10": 25.9, "12": 19, "14": 14.6, "16": 11.3 },
            "31.6": { "5": 80, "6": 60, "7": 42.6, "8": 34, "9": 31, "10": 26, "12": 19.1, "14": 14.2, "16": 11, "18": 9, "20": 7.6, "22": 6.3, "24": 4.8 },
            "40.5": { "7": 50.4, "8": 38.7, "9": 30.6, "10": 25.2, "12": 18, "14": 13.2, "16": 10, "18": 8, "20": 5.8, "22": 4.2, "24": 2.8, "26": 1.7, "28": 2 },
            "53.8": { "11": 20, "12": 16.9, "14": 12.3, "16": 9.5, "18": 6.9, "20": 5, "22": 3.2, "24": 1.8, "26": 2.2, "28": 1.3, "30": 1.2 },
            "67.1": { "16": 10, "18": 7.4, "20": 5.5, "22": 3.8, "24": 2.5, "26": 1.5, "28": 0 },
            "73": { "18": 7.5, "20": 5.6, "22": 3.6, "24": 2.5, "26": 1.2 }
        };

        // Peta Load Chart utama berdasarkan Tipe Crane
        // BARU: Direstrukturisasi untuk mendukung multi-CW
        const LOAD_CHARTS = {
            '160': {
                '52': SAC1600S_LOAD_CHART_52T,
                '43': SAC1600S_LOAD_CHART_43T,
                '32.5': SAC1600S_LOAD_CHART_32_5T,
                '20.5': SAC1600S_LOAD_CHART_20_5T,
                '17.5': SAC1600S_LOAD_CHART_17_5T,
                '9.5': SAC1600S_LOAD_CHART_9_5T,
                '1.5': {} // Tidak ada data chart untuk 1.5T
            },
            '250': {
                // BARU: Dipetakan ke data 250T yang relevan
                '62': SAC2500S_LOAD_CHART_62T,
                '50.5': SAC2500S_LOAD_CHART_50_5T,
                '40.5': SAC2500S_LOAD_CHART_40_5T,
                '30.5': SAC2500S_LOAD_CHART_30_5T,
                '20.5': SAC2500S_LOAD_CHART_20_5T,
                '15': SAC2500S_LOAD_CHART_15T,
                '0': SAC2500S_LOAD_CHART_0T
            }
        };


        // Outrigger positions relative to Center (0,0) in degrees (North = 0, Clockwise)
        // C=45, D=135, A=225, B=315
        const OUTRIGGER_POSITIONS = {
            'C': 45,
            'D': 135,
            'A': 225,
            'B': 315
        };

        const PI = Math.PI;

        //---------------------------------------------------------
        // LOGIKA INTERAKSI MOUSE (SWING)
        //---------------------------------------------------------

        function calculateAngle(x, y, centerX, centerY) {
            const dx = x - centerX;
            const dy = y - centerY;
            
            let angle = Math.atan2(dy, dx) * (180 / PI);
            
            if (angle < 0) angle += 360;
            
            let finalAngle = 90 - angle;
            if (finalAngle < 0) finalAngle += 360;
            
            return finalAngle; // Sudut 0-360, 0=North, Clockwise
        }

        let isDragging = false;
        let interactiveArea;
        let boomSvg;

        function rotateBoomIndicator(angle) {
            const line = document.getElementById('boom-indicator');
            document.getElementById('current-angle').textContent = angle.toFixed(1) + '°';

            line.setAttribute('transform', `rotate(${angle}, 50, 50)`);
            
            const radiusLength = 30;
            const cartesianAngle = (90 - angle) * (PI / 180); 
            
            const x2 = 50 + radiusLength * Math.cos(cartesianAngle);
            const y2 = 50 - radiusLength * Math.sin(cartesianAngle);

            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);

            runFullCalculation(angle);
        }

        function handleMouseMove(e) {
            if (!isDragging) return;
            
            const rect = interactiveArea.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const x = e.clientX;
            const y = e.clientY;

            const angle = calculateAngle(x, y, centerX, centerY);
            rotateBoomIndicator(angle);
        }

        function handleMouseDown(e) {
            if (e.target.closest('svg') === boomSvg) {
                isDragging = true;
                interactiveArea.classList.add('dragging');
                e.preventDefault();
                handleMouseMove(e);
            }
        }

        function handleMouseUp() {
            if (isDragging) {
                isDragging = false;
                interactiveArea.classList.remove('dragging');
            }
        }

        //---------------------------------------------------------
        // LOGIKA VISUALISASI BOOM (Canvas)
        //---------------------------------------------------------
        
        /**
         * Mencari kapasitas angkat dari load chart yang di-hardcode.
         * BARU: Menerima counterweight sebagai parameter
         */
        function getLiftingCapacity(radius, boomLength, craneType, counterweight) {
            const craneCharts = LOAD_CHARTS[craneType];
            if (!craneCharts) return { capacity: "N/A (Crane?)", capacityValue: 0, isError: true };

            const chartData = craneCharts[counterweight.toString()];
            
            // PERBAIKAN: Menggunakan | (Logical OR)
            if (!chartData | Object.keys(chartData).length === 0) { 
                return { capacity: `N/A (No Chart for ${counterweight}T)`, capacityValue: 0, isError: true };
            }
            
            // 1. Temukan kunci boom yang paling sesuai (pertama yang >= L)
            const availableBoomKeys = Object.keys(chartData).map(parseFloat).sort((a, b) => a - b);
            let closestBoomKey = availableBoomKeys.find(k => k >= boomLength);
            
            if (!closestBoomKey) {
                return { capacity: "ERR: L > MAX", capacityValue: 0, isError: true };
            }

            const radiusChart = chartData[closestBoomKey.toString()];
            if (!radiusChart) return { capacity: "N/A", capacityValue: 0, isError: true };

            // 2. Temukan kunci radius yang paling sesuai (terdekat <= R)
            const radiusKeys = Object.keys(radiusChart).map(parseFloat).sort((a, b) => a - b);
            
            let applicableRadiusKey = null;
            for (const rKey of radiusKeys) {
                if (rKey <= radius) {
                    applicableRadiusKey = rKey;
                } else {
                    break; // Stop ketika R melebihi kunci
                }
            }

            if (applicableRadiusKey === null) {
                return { capacity: "ERR: R < MIN", capacityValue: 0, isError: true };
            }

            const capacity = radiusChart[applicableRadiusKey.toString()];

            if (!capacity) {
                 if (radius > radiusKeys[radiusKeys.length -1]) {
                     return { capacity: "ERR: R > MAX", capacityValue: 0, isError: true };
                 }
                 return { capacity: "N/A", capacityValue: 0, isError: true };
            }
            
            return { capacity: `${capacity} Ton`, capacityValue: capacity, isError: false };
        }
        
        function resizeCanvas() {
            const canvas = document.getElementById('boom-canvas');
            const container = document.getElementById('load-chart-display');
            if (container) {
                canvas.width = container.clientWidth - 8; // Adjust for padding/border
                // Redraw on resize
                runFullCalculation(); // Memanggil runFullCalculation akan otomatis menggambar ulang
            }
        }

        function drawBoomDiagram(radius, boomLength, craneType, counterweight) {
            const canvas = document.getElementById('boom-canvas');
            if (!canvas.getContext) return; // handle error
            const ctx = canvas.getContext('2d');
            
            const containerWidth = canvas.width; 
            const containerHeight = canvas.height; 
            
            const { MAX_RADIUS, MAX_HEIGHT, BOOM_LENGTHS } = CRANE_DATA[craneType];
            const MARGIN = 30;

            const centerX = MARGIN; 
            const centerY = canvas.height - MARGIN; 

            const scale = Math.min((containerWidth - 2 * MARGIN) / MAX_RADIUS, (containerHeight - 2 * MARGIN) / MAX_HEIGHT);
            
            const scaledRadius = radius * scale; 
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // --- Grid dan Sumbu ---
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.font = '12px Inter';
            ctx.fillStyle = '#666';

            for (let r = 0; r <= MAX_RADIUS; r += 10) {
                const x = centerX + r * scale;
                ctx.strokeStyle = '#eee';
                ctx.setLineDash([2, 2]);
                ctx.beginPath();
                ctx.moveTo(x, centerY);
                ctx.lineTo(x, MARGIN);
                ctx.stroke();
                ctx.fillText(`${r}m`, x - 10, centerY + 15);
            }
             for (let h = 0; h <= MAX_HEIGHT; h += 10) {
                const y = centerY - h * scale;
                ctx.strokeStyle = '#eee';
                ctx.setLineDash([2, 2]);
                ctx.beginPath();
                ctx.moveTo(centerX, y);
                ctx.lineTo(canvas.width - MARGIN, y);
                ctx.stroke();
                ctx.fillText(`${h}m`, centerX - 25, y + 5);
            }
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, 2 * PI);
            ctx.fillStyle = '#004d99';
            ctx.fill();
            
            // --- Kurva Boom (Simulasi Jangkauan) ---
            ctx.strokeStyle = 'rgba(0, 77, 153, 0.5)';
            ctx.lineWidth = 1;
            BOOM_LENGTHS.forEach(L => {
                if (L > 0) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, L * scale, -PI, 0); 
                    ctx.stroke();
                }
            });

            // --- Indikator Radius Aktif ---
            ctx.beginPath();
            ctx.moveTo(centerX + scaledRadius, centerY);
            ctx.lineTo(centerX + scaledRadius, MARGIN);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.fillStyle = 'red';
            ctx.font = '14px Inter';
            ctx.fillText(`Radius Aktif: ${radius.toFixed(1)}m`, centerX + scaledRadius + 5, MARGIN + 15);
            ctx.setLineDash([]);

            // --- Validasi L vs R ---
            if (boomLength < radius) {
                ctx.fillStyle = 'red';
                ctx.font = 'bold 16px Inter';
                ctx.fillText("ERROR: Panjang Boom (L) < Radius (R)!", centerX + 10, centerY - 150);
                ctx.fillText("Kapasitas Angkat: INVALID", centerX + 10, centerY - 130);
                return; // Stop drawing
            }

            // --- Logika Kapasitas Angkat (BARU) ---
            const boomAngleRad = Math.acos(radius / boomLength);
            const boomHeight = Math.sin(boomAngleRad) * boomLength;
            const hookX = centerX + scaledRadius;
            const hookY = centerY - boomHeight * scale;

            // BARU: Menggunakan counterweight
            const capacityResult = getLiftingCapacity(radius, boomLength, craneType, counterweight);
            const netLoad = parseFloat(document.getElementById('net-load').value) || 0;

            // Gambar Titik Hook
            ctx.beginPath();
            ctx.arc(hookX, hookY, 4, 0, 2 * PI);
            ctx.fillStyle = '#FFC107';
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.stroke();
            
            // Gambar Teks (Ketinggian DAN Kapasitas)
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Inter';
            ctx.fillText(`Hook Max Height: ${boomHeight.toFixed(1)}m`, hookX + 10, hookY + 5);
            
            let capacityText = `Kapasitas Angkat: ${capacityResult.capacity}`;
            let capacityColor = '#059669'; // Green

            if (capacityResult.isError || netLoad > capacityResult.capacityValue) {
                capacityText = `Kapasitas Angkat: ${capacityResult.capacity} (BERBAHAYA!)`;
                capacityColor = '#DC2626'; // Red
            }
            
            ctx.fillStyle = capacityColor;
            ctx.font = 'bold 14px Inter';
            ctx.fillText(capacityText, hookX + 10, hookY + 25); 

            // Gambar Garis Boom
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(hookX, hookY);
            ctx.strokeStyle = '#004d99';
            ctx.lineWidth = 3;
            ctx.stroke();
        }


        //---------------------------------------------------------
        // LOGIKA KALKULASI UTAMA
        //---------------------------------------------------------
        
        /**
         * Mengkalkulasi Pmax berdasarkan input.
         * Mengembalikan Objek dengan Pmax_final dan komponennya.
         */
        function calculatePmaxFromLoad(netLoad, radius, craneType) {
            const data = CRANE_DATA[craneType];
            const daf = parseFloat(document.getElementById('daft').value) || 1.25;
            const cw_weight = parseFloat(document.getElementById('counterweight').value) || data.CW_DEFAULT;

            const safeNetLoad = parseFloat(netLoad) || 0;
            const safeRadius = parseFloat(radius) || 0;
            const safeDaf = parseFloat(daf) || 1.25;

            const W_total_lift = safeNetLoad + data.W_HOOK_RIGGING; 
            
            const M_LOAD = W_total_lift * safeRadius;
            const M_COUNTERWEIGHT = cw_weight * data.R_CW_CRITICAL;
            
            const M_NET = M_LOAD - M_COUNTERWEIGHT;

            let Pmax_moment_component = 0;
            if (M_NET > 0) {
                 Pmax_moment_component = M_NET / (2 * data.R_TIPPING_LINE);
            }
            
            const TotalWeight = data.W_CRANE_BODY + cw_weight + W_total_lift;
            const Pmax_vertical_component = TotalWeight / 4;
            
            const Pmax_calc = Pmax_moment_component + Pmax_vertical_component;
            const Pmax_final = Pmax_calc * safeDaf;

            // Pastikan Pmax tidak pernah lebih rendah dari beban statis per kaki jika tidak ada momen
            const minPmax = (TotalWeight / 4) * safeDaf;

            const finalResult = Math.max(minPmax, Pmax_final);

            if (isNaN(finalResult)) {
                 return {
                    Pmax_final: data.Pmax_DEFAULT,
                    M_NET: 0, Pmax_moment_component: 0, Pmax_vertical_component: data.W_CRANE_BODY / 4,
                    Pmax_calc: data.W_CRANE_BODY / 4, safeDaf: safeDaf, W_total_lift: 0, cw_weight: cw_weight
                 };
            }

            return {
                Pmax_final: finalResult,
                M_NET: M_NET,
                Pmax_moment_component: Pmax_moment_component,
                Pmax_vertical_component: Pmax_vertical_component,
                Pmax_calc: Pmax_calc,
                safeDaf: safeDaf,
                W_total_lift: W_total_lift,
                cw_weight: cw_weight
            };
        }

        /**
         * Menggunakan korelasi IRC 37 (Estimasi) untuk GBP (q_allow)
         * q_allow (kPa) = 17.6 * (CBR)^0.64
         * q_allow (Ton/m^2) = (17.6 * (CBR)^0.64) / 9.81
         * Disederhanakan menjadi: 1.76 * (CBR)^0.64
         */
        function convertCBRtoGBP(cbr) {
            const safeCbr = parseFloat(cbr) || 1.0;
            // q_allow (T/m^2) = 1.76 * (CBR)^0.64
            const gbp_ton_m2 = 1.76 * Math.pow(safeCbr, 0.64);
            return gbp_ton_m2;
        }
        

        /**
         * Menghitung distribusi beban pada 4 outrigger berdasarkan sudut putaran.
         */
        function calculateOutriggerForces(Pmax, TotalWeight, angle) {
            const safePmax = parseFloat(Pmax) || 0;
            const safeTotalWeight = parseFloat(TotalWeight) || 0;
            
            const P_static = safeTotalWeight / 4; 
            const P_extra = safePmax - P_static; 

            if (P_extra <= 0) {
                 return {
                    P_C: P_static.toFixed(1), P_D: P_static.toFixed(1),
                    P_A: P_static.toFixed(1), P_B: P_static.toFixed(1),
                    critical: 'NONE'
                 };
            }

            const outriggerKeys = ['C', 'D', 'A', 'B'];
            const P_outriggers = {}; 
            
            let currentPmaxValue = 0;
            let actualCritical = 'C';
            let totalFactor = 0;
            
            for (const key of outriggerKeys) {
                const posAngle = OUTRIGGER_POSITIONS[key];
                
                let diff = Math.abs(angle - posAngle);
                if (diff > 180) diff = 360 - diff;
                
                let factor = Math.cos(diff * (PI / 180));
                factor = Math.max(0, factor * factor);
                
                P_outriggers[`P_${key}`] = P_static + factor * P_extra; 
                totalFactor += factor;
            }

            if (totalFactor > 0) {
                const P_extra_sum = totalFactor * P_extra; 
                
                for (const key of outriggerKeys) {
                    const P_moment_component = P_outriggers[`P_${key}`] - P_static;
                    P_outriggers[`P_${key}`] = P_static + P_moment_component * (P_extra / P_extra_sum);
                }
            }
            
            for (const key of outriggerKeys) {
                 if (P_outriggers[`P_${key}`] > currentPmaxValue) {
                    currentPmaxValue = P_outriggers[`P_${key}`];
                    actualCritical = key;
                }
            }
            
            const normalizationFactor = safePmax / currentPmaxValue;
            
            const outriggerKeysNormalized = ['C', 'D', 'A', 'B']; 
            for (const key of outriggerKeysNormalized) {
                 P_outriggers[`P_${key}`] *= normalizationFactor;
            }
            
            return {
                P_A: P_outriggers.P_A.toFixed(1), P_B: P_outriggers.P_B.toFixed(1),
                P_C: P_outriggers.P_C.toFixed(1), P_D: P_outriggers.P_D.toFixed(1),
                critical: actualCritical
            };
        }
        
        /**
         * Fungsi utama yang menjalankan semua kalkulasi dan pembaruan UI.
         * Dipanggil oleh setiap perubahan input atau pergerakan boom.
         */
        function runFullCalculation(angle) {
            // Jika angle tidak disediakan (dipanggil oleh input change), gunakan angle saat ini
            const currentAngle = angle ?? parseFloat(document.getElementById('current-angle').textContent) | 45;
            
            // 1. Baca semua input
            const netLoad = document.getElementById('net-load').value;
            const radius = document.getElementById('radius').value;
            const craneType = document.getElementById('crane-type').value;
            const cbr = document.getElementById('cbr').value;
            const boomLength = document.getElementById('boom-length-number').value;
            const d_pad = document.getElementById('pad-diameter').value;
            const daf = document.getElementById('daft').value;
            const cw_weight_val = document.getElementById('counterweight').value;

            // 2. Kalkulasi Pmax dan komponennya
            const pmaxResult = calculatePmaxFromLoad(netLoad, radius, craneType);
            const Pmax = pmaxResult.Pmax_final;

            // 3. Update Pmax di UI
            document.getElementById('pmax-calc').value = Pmax.toFixed(1);
            document.getElementById('final-pmax-value').textContent = Pmax.toFixed(1);
            
            // 4. Update Rumus Pmax di UI (BARU)
            const pmaxFormulaEl = document.getElementById('formula-pmax');
            const pmax_formula_text = `<b>Pmax = (P_Momen + P_Vertikal) * DAF</b> &rarr; (${pmaxResult.Pmax_moment_component.toFixed(1)} T + ${pmaxResult.Pmax_vertical_component.toFixed(1)} T) * ${pmaxResult.safeDaf} = ${Pmax.toFixed(1)} T`;
            pmaxFormulaEl.innerHTML = pmax_formula_text;
            
            // 5. Validasi input sebelum lanjut
            const safeCbrInput = parseFloat(cbr); 
            // PERBAIKAN: Menggunakan | (Logical OR)
            if (isNaN(Pmax) | isNaN(safeCbrInput) | Pmax <= 0 | safeCbrInput <= 0) {
                document.getElementById('gbp-value').textContent = 'NaN';
                document.getElementById('area-required').textContent = 'NaN';
                document.getElementById('mat-dimension').textContent = 'NaN x NaN';
                
                const pressureCheckDiv = document.getElementById('pressure-check');
                pressureCheckDiv.className = `p-3 rounded-lg bg-red-100`;
                document.getElementById('actual-pressure').textContent = 'NaN';
                document.getElementById('safety-status').textContent = 'ERROR: Masukkan semua nilai input yang valid.';
                document.getElementById('results').style.display = 'block';
                return;
            }

            // 6. Perhitungan Mat dan Keamanan Global
            const safeCbr = safeCbrInput || 1.0;
            const GBP = convertCBRtoGBP(safeCbr);
            const A_req = Pmax / GBP; 
            const side_req = Math.sqrt(A_req);
            const recommended_side = Math.ceil(side_req * 10) / 10; 
            const actual_area = recommended_side * recommended_side;
            const actual_pressure = Pmax / actual_area;
            
            // 7. Kalkulasi Tebal Steel Plate (Bending)
            const F_b_steel = 16000; // Tegangan Lentur Izin Baja (approx 160 MPa) dalam Ton/m²
            const safe_d_pad = parseFloat(d_pad) || 0.6;
            let t_mm = 25; // Tebal minimum default
            const c = (recommended_side - safe_d_pad) / 2; 

            if (c > 0) {
                const t_m = c * Math.sqrt((3 * actual_pressure) / F_b_steel);
                t_mm = t_m * 1000; // Konversi ke mm
            }
            const t_mm_rounded = Math.ceil(t_mm / 5) * 5;

            // 8. Validasi Keamanan Ganda (Tanah & Angkat)
            const safeRadius = parseFloat(radius) || 0;
            const safeBoomLength = parseFloat(boomLength) || 0;
            const safeNetLoad = parseFloat(netLoad) || 0;

            // BARU: Menggunakan cw_weight_val
            const capacityResult = getLiftingCapacity(safeRadius, safeBoomLength, craneType, cw_weight_val);
            
            let isGroundSafe = (actual_pressure < GBP);
            let isLiftSafe = (!capacityResult.isError && safeNetLoad <= capacityResult.capacityValue);
            let isConfigSafe = (safeBoomLength >= safeRadius); 

            const safe_status = isGroundSafe && isLiftSafe && isConfigSafe;

            let status_text;
            let pressure_check_bg = 'bg-red-100';
            let pressure_check_text_color = 'text-red-800';

            if (safe_status) {
                status_text = `STATUS: AMAN (HIJAU). Tekanan Aktual (${actual_pressure.toFixed(1)} Ton/m²) < GBP Izin (${GBP.toFixed(1)} Ton/m²).`;
                pressure_check_bg = 'bg-green-100';
                pressure_check_text_color = 'text-green-800';
            } else {
                if (!isGroundSafe) {
                    status_text = `STATUS: TIDAK AMAN (MERAH)! Tekanan Aktual (${actual_pressure.toFixed(1)} T/m²) > GBP Izin (${GBP.toFixed(1)} T/m²).`;
                } else if (!isLiftSafe) {
                    status_text = `STATUS: TIDAK AMAN (MERAH)! Beban Angkat (${safeNetLoad.toFixed(1)} T) > Kapasitas Izin (${capacityResult.capacity}).`;
                } else if (!isConfigSafe) {
                    status_text = `STATUS: TIDAK AMAN (MERAH)! Panjang Boom (${safeBoomLength.toFixed(1)} m) < Radius (${safeRadius.toFixed(1)} m).`;
                }
            }


            // 9. Simulasi Beban 4 Titik
            const defaults = CRANE_DATA[craneType];
            const cw_weight = parseFloat(cw_weight_val) || defaults.CW_DEFAULT;
            const TotalWeightEstimation = defaults.W_CRANE_BODY + cw_weight + safeNetLoad + defaults.W_HOOK_RIGGING;
            const forces = calculateOutriggerForces(Pmax, TotalWeightEstimation, currentAngle);
            const criticalDirection = forces.critical;

            // 10. Update Diagram Visual
            const outriggers = { 
                A: document.getElementById('outrigger-A'), B: document.getElementById('outrigger-B'), 
                C: document.getElementById('outrigger-C'), D: document.getElementById('outrigger-D') 
            };
            const force_spans = {
                A: document.getElementById('force-a'), B: document.getElementById('force-b'), 
                C: document.getElementById('force-c'), D: document.getElementById('force-d')
            };

            ['A', 'B', 'C', 'D'].forEach(p => {
                const is_critical = p === criticalDirection;
                const is_safe = safe_status; // Keamanan keseluruhan

                let P_val = forces[`P_${p}`];
                force_spans[`${p}`].textContent = `P_${p}: ${P_val} Ton${is_critical ? ' (Max)' : ''}`;

                outriggers[`${p}`].classList.remove('critical-safe', 'critical-unsafe', 'secondary');
                
                if (is_critical) {
                    outriggers[`${p}`].classList.add(is_safe ? 'critical-safe' : 'critical-unsafe');
                    force_spans[`${p}`].classList.remove('text-gray-700', 'text-red-600', 'text-green-600');
                    force_spans[`${p}`].classList.add(is_safe ? 'text-green-600' : 'text-red-600');
                } else {
                    outriggers[`${p}`].classList.add('secondary');
                    force_spans[`${p}`].classList.remove('text-red-600', 'text-green-600');
                    force_spans[`${p}`].classList.add('text-gray-700');
                }
            });

            // 11. Update Results Display dan Visualisasi Boom
            document.getElementById('gbp-value').textContent = GBP.toFixed(1);
            document.getElementById('cbr-note').innerHTML = `<b>Formula IRC 37:</b> q_allow (T/m²) = 1.76 * (CBR)^0.64<br><b>Kalkulasi:</b> 1.76 * (${(safeCbr || 0).toFixed(0)}^0.64) = ${GBP.toFixed(1)} T/m²`;

            document.getElementById('area-required').textContent = A_req.toFixed(2);
            document.getElementById('mat-dimension').textContent = `${recommended_side.toFixed(1)} x ${recommended_side.toFixed(1)} m x ${t_mm_rounded.toFixed(0)} mm`;
            
            document.getElementById('formula-area').innerHTML = `<b>Rumus Luas (A):</b> Pmax / GBP &rarr; ${Pmax.toFixed(1)} Ton / ${GBP.toFixed(1)} T/m² = ${A_req.toFixed(2)} m²`;
            document.getElementById('formula-side').innerHTML = `<b>Rumus Sisi (L):</b> &radic;A &rarr; &radic;${A_req.toFixed(2)} = ${side_req.toFixed(2)} m &rarr; Dibulatkan <b>${recommended_side.toFixed(1)} m</b>`;
            document.getElementById('formula-thickness').innerHTML = `<b>Rumus Tebal (T):</b> c * &radic;((3 * P_aktual) / F_b) &rarr; ${c.toFixed(2)}m * &radic;((3 * ${actual_pressure.toFixed(1)}) / ${F_b_steel}) = ${t_mm.toFixed(1)} mm &rarr; Dibulatkan <b>${t_mm_rounded.toFixed(0)} mm</b>`;

            const pressureCheckDiv = document.getElementById('pressure-check');
            pressureCheckDiv.className = `p-3 rounded-lg ${pressure_check_bg}`;
            document.getElementById('actual-pressure').textContent = actual_pressure.toFixed(1);
            document.getElementById('actual-pressure').classList.add(pressure_check_text_color);
            document.getElementById('safety-status').textContent = status_text;

            document.getElementById('results').style.display = 'block';

            // 12. Update Visualisasi Boom (Canvas)
            const loadChartDisplay = document.getElementById('load-chart-display');
            const loadChartTitle = document.getElementById('load-chart-title');
            
            if (craneType === '160' || craneType === '250') {
                loadChartTitle.textContent = `Visualisasi Jangkauan Boom (${craneType === '160' ? 'SAC1600S' : 'SAC2500S'})`;
                loadChartDisplay.style.display = 'block';
                // BARU: Menggunakan cw_weight_val
                drawBoomDiagram(safeRadius, safeBoomLength, craneType, cw_weight_val);
            } else {
                loadChartDisplay.style.display = 'none';
            }
        }

        // BARU: Opsi dropdown untuk setiap crane
        const CW_OPTIONS = {
            '160': [
                { value: '52', text: '52 Ton' },
                { value: '43', text: '43 Ton' },
                { value: '32.5', text: '32.5 Ton' },
                { value: '20.5', text: '20.5 Ton' },
                { value: '17.5', text: '17.5 Ton' },
                { value: '9.5', text: '9.5 Ton' },
                { value: '1.5', text: '1.5 Ton' }
            ],
            '250': [
                // Menggunakan data 250T (62, 50.5, 40.5, 30.5, 20.5, 15, 0)
                { value: '62', text: '62 Ton (Std)' },
                { value: '50.5', text: '50.5 Ton' },
                { value: '40.5', text: '40.5 Ton' },
                { value: '30.5', text: '30.5 Ton' },
                { value: '20.5', text: '20.5 Ton' },
                { value: '15', text: '15 Ton' },
                { value: '0', text: '0 Ton' }
            ]
        };

        /**
         * Mengatur nilai default input saat Tipe Crane berubah.
         */
        function updateDefaults() {
            const craneType = document.getElementById('crane-type').value;
            const defaults = CRANE_DATA[craneType];
            
            // BARU: Mengisi ulang dropdown CW
            const cwSelect = document.getElementById('counterweight');
            cwSelect.innerHTML = ''; // Kosongkan
            CW_OPTIONS[craneType].forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.text = opt.text;
                cwSelect.appendChild(option);
            });
            
            cwSelect.value = defaults.CW_DEFAULT; 
            
            document.getElementById('net-load').value = '20';
            document.getElementById('radius').value = defaults.R_CRITICAL.toFixed(1);
            
            const defaultBoomLength = defaults.BOOM_LENGTHS[1] || defaults.BOOM_LENGTHS[0];
            document.getElementById('boom-length-slider').value = defaultBoomLength;
            document.getElementById('boom-length-number').value = defaultBoomLength;

            // Jalankan kalkulasi penuh setelah reset
            runFullCalculation();
        }

        // Pindahkan deklarasi fungsi yang akan dipanggil dari HTML atau event listener ke tingkat global
        window.runFullCalculation = runFullCalculation;
        window.updateDefaults = updateDefaults;

        // Tambahkan event listeners di dalam DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            interactiveArea = document.getElementById('interactive-diagram-area');
            boomSvg = document.getElementById('boom-svg');
            
            // Event listener untuk drag and drop (putar boom)
            boomSvg.addEventListener('mousedown', handleMouseDown); 
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);

            // Event listener untuk input data
            document.getElementById('net-load').addEventListener('input', runFullCalculation);
            document.getElementById('radius').addEventListener('input', runFullCalculation);
            document.getElementById('daft').addEventListener('input', runFullCalculation);
            document.getElementById('cbr').addEventListener('input', runFullCalculation);
            document.getElementById('pad-diameter').addEventListener('input', runFullCalculation);
            document.getElementById('crane-type').addEventListener('change', updateDefaults); // Memanggil updateDefaults
            document.getElementById('counterweight').addEventListener('change', runFullCalculation);
            
            // Listener baru untuk Boom Length
            const boomLengthSlider = document.getElementById('boom-length-slider');
            const boomLengthNumber = document.getElementById('boom-length-number');

            boomLengthSlider.addEventListener('input', () => {
                boomLengthNumber.value = boomLengthSlider.value;
                runFullCalculation();
            });
            boomLengthNumber.addEventListener('input', () => {
                boomLengthSlider.value = boomLengthNumber.value;
                runFullCalculation();
            });


            // Inisialisasi canvas resize
            window.addEventListener('resize', resizeCanvas);
            
            // Inisialisasi awal
            updateDefaults();
            rotateBoomIndicator(45);
            
            // Panggil resizeCanvas untuk inisialisasi ukuran pertama kali
            resizeCanvas();
        });
    </script>
</body>
</html>